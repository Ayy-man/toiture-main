---
phase: 17-production-fixes
plan: 01
type: config
wave: 1
depends_on: []
autonomous: false

user_setup:
  - service: vercel
    why: "Fix mixed content blocking"
    env_vars:
      - name: NEXT_PUBLIC_API_URL
        current: "http://toiture-main-production-d6a5.up.railway.app"
        required: "https://toiture-main-production-d6a5.up.railway.app"
    dashboard_config:
      - task: "Update NEXT_PUBLIC_API_URL to use HTTPS"
        location: "Vercel Dashboard -> Project Settings -> Environment Variables"
      - task: "Trigger redeploy"
        location: "Vercel Dashboard -> Deployments -> Redeploy"

must_haves:
  truths:
    - "NEXT_PUBLIC_API_URL starts with https://"
    - "No Mixed Content warnings in browser console"
    - "Frontend can reach backend API endpoints"
  artifacts:
    - path: "Vercel environment"
      provides: "HTTPS API URL"
---

<objective>
Fix mixed content blocking by updating NEXT_PUBLIC_API_URL from http:// to https:// in Vercel environment variables.

Purpose: Browser blocks HTTP requests from HTTPS pages. This is silently breaking all API calls.

Output: Frontend successfully makes HTTPS requests to Railway backend.
</objective>

<context>
@.planning/phases/17-production-fixes/17-RESEARCH.md
</context>

<tasks>

<task type="manual">
  <name>Task 1: Check Current NEXT_PUBLIC_API_URL</name>
  <action>
1. Go to Vercel Dashboard
2. Select the Toiture Cortex project
3. Go to Settings → Environment Variables
4. Find NEXT_PUBLIC_API_URL
5. Note the current value - does it start with http:// or https://?
  </action>
  <done>
    - Current value documented
    - Confirmed whether it's HTTP or HTTPS
  </done>
</task>

<task type="manual">
  <name>Task 2: Update to HTTPS</name>
  <action>
If NEXT_PUBLIC_API_URL starts with http://, change it to https://

Example:
- Before: http://toiture-main-production-d6a5.up.railway.app
- After: https://toiture-main-production-d6a5.up.railway.app

1. Click Edit on the environment variable
2. Change http:// to https://
3. Save changes
  </action>
  <done>
    - NEXT_PUBLIC_API_URL updated to HTTPS
  </done>
</task>

<task type="manual">
  <name>Task 3: Trigger Vercel Redeploy</name>
  <action>
1. Go to Deployments tab
2. Find the latest production deployment
3. Click the 3-dot menu → Redeploy
4. Wait for deployment to complete (~1-2 minutes)
  </action>
  <done>
    - New deployment completed successfully
  </done>
</task>

<task type="auto">
  <name>Task 4: Verify Mixed Content Fixed</name>
  <action>
Test that the frontend can now reach the backend:

```bash
# Get the Vercel URL and test
VERCEL_URL="https://toiture-cortex.vercel.app"  # Update with actual URL

# Open browser console and check for Mixed Content warnings
# Or use curl to verify the page loads
curl -s "$VERCEL_URL" | head -20
```

In browser:
1. Open the Vercel URL
2. Open DevTools (F12) → Console tab
3. Look for "Mixed Content" warnings
4. Should see NO mixed content warnings
  </action>
  <verify>
```bash
# Test backend is reachable via HTTPS
curl -s https://toiture-main-production-d6a5.up.railway.app/health
```
Expected: {"status": "healthy"}
  </verify>
  <done>
    - No Mixed Content warnings in console
    - Backend health check returns 200 via HTTPS
  </done>
</task>

</tasks>

<verification>
- [ ] NEXT_PUBLIC_API_URL in Vercel starts with https://
- [ ] Vercel redeploy completed
- [ ] No Mixed Content warnings in browser console
- [ ] curl to backend health endpoint returns 200
</verification>

<success_criteria>
1. Environment variable updated to use HTTPS
2. Frontend successfully communicates with backend
3. No browser security warnings
</success_criteria>

<output>
After completion, create `.planning/phases/17-production-fixes/17-01-SUMMARY.md`
</output>
