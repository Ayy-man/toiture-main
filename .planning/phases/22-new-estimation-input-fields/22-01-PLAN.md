---
phase: 22-new-estimation-input-fields
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/app/schemas/hybrid_quote.py
  - backend/app/schemas/estimate.py
  - backend/app/models/equipment_config.json
  - frontend/src/lib/schemas/hybrid-quote.ts
  - frontend/src/types/hybrid-quote.ts
  - frontend/src/lib/i18n/fr.ts
  - frontend/src/lib/i18n/en.ts
  - frontend/src/components/ui/radio-group.tsx
autonomous: true
must_haves:
  truths:
    - "Backend accepts all 7 new optional fields without breaking existing quotes"
    - "Frontend Zod schema validates all 7 new field groups with correct defaults"
    - "All ~50 new i18n keys exist in both fr.ts and en.ts with real translations"
    - "RadioGroup shadcn component is installed and importable"
    - "Equipment config JSON defines 5 items with bilingual names and placeholder prices"
  artifacts:
    - path: "backend/app/schemas/hybrid_quote.py"
      provides: "7 new Optional fields on HybridQuoteRequest"
      contains: "employee_compagnons"
    - path: "backend/app/schemas/estimate.py"
      provides: "Unchanged — EstimateRequest not modified (only HybridQuoteRequest needs new fields)"
    - path: "backend/app/models/equipment_config.json"
      provides: "5 equipment items with id, name_fr, name_en, daily_cost"
      min_lines: 10
    - path: "frontend/src/lib/schemas/hybrid-quote.ts"
      provides: "Zod validation for 7 new field groups"
      contains: "employee_compagnons"
    - path: "frontend/src/types/hybrid-quote.ts"
      provides: "TypeScript interface fields matching new Pydantic schema"
      contains: "employee_compagnons"
    - path: "frontend/src/lib/i18n/fr.ts"
      provides: "~25 new French translation keys under fullQuote"
      contains: "compagnons"
    - path: "frontend/src/lib/i18n/en.ts"
      provides: "~25 new English translation keys under fullQuote"
      contains: "compagnons"
    - path: "frontend/src/components/ui/radio-group.tsx"
      provides: "shadcn RadioGroup + RadioGroupItem components"
      contains: "RadioGroup"
  key_links:
    - from: "frontend/src/lib/schemas/hybrid-quote.ts"
      to: "backend/app/schemas/hybrid_quote.py"
      via: "field names match exactly"
      pattern: "employee_compagnons.*employee_apprentis.*employee_manoeuvres"
    - from: "frontend/src/types/hybrid-quote.ts"
      to: "backend/app/schemas/hybrid_quote.py"
      via: "TypeScript interface mirrors Pydantic model"
      pattern: "duration_type.*geographic_zone.*premium_client_level"
---

<objective>
Add all schema fields, config files, i18n keys, and UI components needed before building the form UI.

Purpose: Establish the data layer and translation infrastructure for 6 new estimation field groups (employee count, duration, geographic zone, premium client level, tools/equipment, supply chain risk). Access difficulty is already done in Phase 21.

Output: Updated backend Pydantic schemas, frontend Zod schemas, TypeScript types, equipment config JSON, ~50 i18n keys, and RadioGroup component installed.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-new-estimation-input-fields/22-RESEARCH.md
@backend/app/schemas/hybrid_quote.py
@backend/app/schemas/estimate.py
@frontend/src/lib/schemas/hybrid-quote.ts
@frontend/src/types/hybrid-quote.ts
@frontend/src/lib/i18n/fr.ts
@frontend/src/lib/i18n/en.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Backend Pydantic schema + Equipment config + RadioGroup install</name>
  <files>
    backend/app/schemas/hybrid_quote.py
    backend/app/models/equipment_config.json
    frontend/src/components/ui/radio-group.tsx
  </files>
  <action>
**1a. Add 7 new Optional fields to HybridQuoteRequest in `backend/app/schemas/hybrid_quote.py`.**

Add these fields AFTER the `manual_extra_hours` field (line ~103) and BEFORE the `# OLD: Legacy complexity factors` comment (line ~105):

```python
# NEW: Employee count (Phase 22)
employee_compagnons: Optional[int] = Field(
    default=None,
    ge=0,
    le=20,
    description="Number of journeyman roofers (compagnons)"
)
employee_apprentis: Optional[int] = Field(
    default=None,
    ge=0,
    le=20,
    description="Number of apprentice roofers (apprentis)"
)
employee_manoeuvres: Optional[int] = Field(
    default=None,
    ge=0,
    le=20,
    description="Number of laborers (manoeuvres)"
)

# NEW: Duration (Phase 22)
duration_type: Optional[str] = Field(
    default=None,
    description="Project duration type: half_day | full_day | multi_day"
)
duration_days: Optional[int] = Field(
    default=None,
    ge=1,
    le=30,
    description="Number of days for multi-day projects"
)

# NEW: Geographic zone (Phase 22)
geographic_zone: Optional[str] = Field(
    default=None,
    description="Geographic zone: core | secondary | north_premium | extended | red_flag"
)

# NEW: Premium client level (Phase 22)
premium_client_level: Optional[str] = Field(
    default=None,
    description="Premium client level: standard | premium_1 | premium_2 | premium_3"
)

# NEW: Equipment items (Phase 22)
equipment_items: Optional[List[str]] = Field(
    default=None,
    description="List of equipment item IDs from equipment_config.json"
)

# NEW: Supply chain risk (Phase 22)
supply_chain_risk: Optional[str] = Field(
    default=None,
    description="Supply chain risk level: standard | extended | import"
)
```

ALL fields MUST be Optional with default=None for backward compatibility. Do NOT modify any validators. Do NOT modify the model_config examples (or optionally add the new fields to the "NEW format" example only).

Also add a field_validator for `duration_type` to constrain values:
```python
@field_validator("duration_type")
@classmethod
def validate_duration_type(cls, v: Optional[str]) -> Optional[str]:
    if v is not None and v not in ("half_day", "full_day", "multi_day"):
        raise ValueError("duration_type must be one of: half_day, full_day, multi_day")
    return v

@field_validator("geographic_zone")
@classmethod
def validate_geographic_zone(cls, v: Optional[str]) -> Optional[str]:
    if v is not None and v not in ("core", "secondary", "north_premium", "extended", "red_flag"):
        raise ValueError("geographic_zone must be one of: core, secondary, north_premium, extended, red_flag")
    return v

@field_validator("premium_client_level")
@classmethod
def validate_premium_client_level(cls, v: Optional[str]) -> Optional[str]:
    if v is not None and v not in ("standard", "premium_1", "premium_2", "premium_3"):
        raise ValueError("premium_client_level must be one of: standard, premium_1, premium_2, premium_3")
    return v

@field_validator("supply_chain_risk")
@classmethod
def validate_supply_chain_risk(cls, v: Optional[str]) -> Optional[str]:
    if v is not None and v not in ("standard", "extended", "import"):
        raise ValueError("supply_chain_risk must be one of: standard, extended, import")
    return v
```

Place these validators BEFORE the existing `validate_category` method.

**DO NOT modify `backend/app/schemas/estimate.py`** — the EstimateRequest model is for the simple `/estimate` endpoint and does not need the new fields. Only HybridQuoteRequest (used by `/estimate/hybrid`) needs them.

**1b. Create `backend/app/models/equipment_config.json`.**

```json
{
  "equipment_items": [
    {
      "id": "crane",
      "name_fr": "Grue",
      "name_en": "Crane",
      "daily_cost": 25.00
    },
    {
      "id": "scaffolding",
      "name_fr": "Echafaudage",
      "name_en": "Scaffolding",
      "daily_cost": 25.00
    },
    {
      "id": "dumpster",
      "name_fr": "Conteneur a dechets",
      "name_en": "Dumpster",
      "daily_cost": 25.00
    },
    {
      "id": "generator",
      "name_fr": "Generatrice",
      "name_en": "Generator",
      "daily_cost": 25.00
    },
    {
      "id": "compressor",
      "name_fr": "Compresseur",
      "name_en": "Compressor",
      "daily_cost": 25.00
    }
  ],
  "_note": "All daily_cost values are symbolic placeholders ($25/day). Laurent needs to provide real rental costs."
}
```

**1c. Install shadcn RadioGroup component.**

Run from the `frontend/` directory:
```bash
cd frontend && npx shadcn@latest add radio-group --yes
```

This creates `frontend/src/components/ui/radio-group.tsx` with RadioGroup and RadioGroupItem exports.
  </action>
  <verify>
1. `python -c "from app.schemas.hybrid_quote import HybridQuoteRequest; r = HybridQuoteRequest(sqft=1000, category='Bardeaux', complexity_tier=2); print('OK:', r.employee_compagnons, r.duration_type, r.geographic_zone, r.premium_client_level, r.equipment_items, r.supply_chain_risk)"` (from backend/ dir) — should print "OK: None None None None None None"
2. `python -c "from app.schemas.hybrid_quote import HybridQuoteRequest; r = HybridQuoteRequest(sqft=1000, category='Bardeaux', complexity_tier=2, employee_compagnons=3, duration_type='full_day', geographic_zone='core', premium_client_level='standard', equipment_items=['crane'], supply_chain_risk='standard'); print('OK:', r.employee_compagnons, r.duration_type)"` — should print "OK: 3 full_day"
3. `cat backend/app/models/equipment_config.json | python -m json.tool` — valid JSON with 5 items
4. `ls frontend/src/components/ui/radio-group.tsx` — file exists
  </verify>
  <done>Backend Pydantic schema accepts all new fields as Optional with None defaults. Existing quotes still validate. Equipment config JSON has 5 items. RadioGroup component installed.</done>
</task>

<task type="auto">
  <name>Task 2: Frontend Zod schema + TypeScript types + i18n keys</name>
  <files>
    frontend/src/lib/schemas/hybrid-quote.ts
    frontend/src/types/hybrid-quote.ts
    frontend/src/lib/i18n/fr.ts
    frontend/src/lib/i18n/en.ts
  </files>
  <action>
**2a. Add 7 new field groups to Zod schema in `frontend/src/lib/schemas/hybrid-quote.ts`.**

Add these fields AFTER `manual_extra_hours` (line 25) and BEFORE `material_lines` (line 28):

```typescript
// NEW: Employee count (Phase 22)
employee_compagnons: z.number().int().min(0).max(20).default(0),
employee_apprentis: z.number().int().min(0).max(20).default(0),
employee_manoeuvres: z.number().int().min(0).max(20).default(0),

// NEW: Duration (Phase 22)
duration_type: z.enum(['half_day', 'full_day', 'multi_day']).default('full_day'),
duration_days: z.number().int().min(1).max(30).optional(),

// NEW: Geographic zone (Phase 22)
geographic_zone: z.enum(['core', 'secondary', 'north_premium', 'extended', 'red_flag']).optional(),

// NEW: Premium client level (Phase 22)
premium_client_level: z.enum(['standard', 'premium_1', 'premium_2', 'premium_3']).default('standard'),

// NEW: Equipment items (Phase 22)
equipment_items: z.array(z.string()).default([]),

// NEW: Supply chain risk (Phase 22)
supply_chain_risk: z.enum(['standard', 'extended', 'import']).default('standard'),
```

**2b. Add corresponding fields to TypeScript interface in `frontend/src/types/hybrid-quote.ts`.**

Add these fields in the HybridQuoteRequest interface AFTER `manual_extra_hours` (line 29) and BEFORE the `// LEGACY` comment (line 31):

```typescript
// NEW: Phase 22 fields
employee_compagnons?: number;
employee_apprentis?: number;
employee_manoeuvres?: number;
duration_type?: 'half_day' | 'full_day' | 'multi_day';
duration_days?: number;
geographic_zone?: 'core' | 'secondary' | 'north_premium' | 'extended' | 'red_flag';
premium_client_level?: 'standard' | 'premium_1' | 'premium_2' | 'premium_3';
equipment_items?: string[];
supply_chain_risk?: 'standard' | 'extended' | 'import';
```

**2c. Add ~25 new i18n keys to `frontend/src/lib/i18n/fr.ts`.**

Add these keys inside the `fullQuote` object, AFTER `totalLaborHours` (last existing key, around line 263):

```typescript
// Phase 22: New estimation input fields
// -- Crew & Duration section
crewDuration: "Equipe et duree",
crewDurationDescription: "Composition de l'equipe et duree du projet",
compagnons: "Compagnons",
apprentis: "Apprentis",
manoeuvres: "Manoeuvres",
totalCrew: "Equipe totale",
workers: "travailleurs",
projectDuration: "Duree du projet",
halfDay: "Demi-journee (<=5h)",
fullDay: "Journee complete (<=10h)",
multiDay: "Multi-jours",
numberOfDays: "Nombre de jours",
// -- Location & Client section
locationClient: "Emplacement et client",
locationClientDescription: "Zone geographique et niveau de service",
geographicZone: "Zone geographique",
selectZone: "Selectionnez une zone",
zoneCore: "Centre (Montreal/Laval)",
zoneSecondary: "Grand Montreal",
zoneNorthPremium: "Rive-Nord / Laurentides",
zoneExtended: "Outaouais / Mauricie",
zoneRedFlag: "Eloigne (Abitibi, Cote-Nord)",
premiumClientLevel: "Niveau de service client",
premiumStandard: "Standard",
premiumStandardDesc: "Service normal",
premium1: "Premium 1",
premium1Desc: "Nettoyage quotidien",
premium2: "Premium 2",
premium2Desc: "Protection du terrain",
premium3: "Premium 3",
premium3Desc: "VIP / Service haut de gamme",
surchargePerDay: "/jour",
surchargeTBD: "Tarif a confirmer",
// -- Equipment & Supply Chain section
equipmentSupplyChain: "Equipement et approvisionnement",
equipmentSupplyChainDescription: "Outils requis et delai de materiaux",
toolsEquipment: "Outils et equipement",
dailyCost: "/jour",
supplyChainRisk: "Risque d'approvisionnement",
supplyStandard: "Standard",
supplyStandardDesc: "<=1 semaine",
supplyExtended: "Etendu",
supplyExtendedDesc: "2-4 semaines",
supplyImport: "Importation",
supplyImportDesc: "6-8 semaines",
supplyWarning: "Attention : Les delais d'approvisionnement prolonges peuvent affecter la planification du projet.",
week: "semaine",
weeks: "semaines",
placeholderPricing: "Tarification symbolique - en attente de confirmation",
```

**2d. Add matching English keys to `frontend/src/lib/i18n/en.ts`.**

Add these keys inside the `fullQuote` object in the same position:

```typescript
// Phase 22: New estimation input fields
// -- Crew & Duration section
crewDuration: "Crew & Duration",
crewDurationDescription: "Team composition and project duration",
compagnons: "Journeymen",
apprentis: "Apprentices",
manoeuvres: "Laborers",
totalCrew: "Total crew",
workers: "workers",
projectDuration: "Project Duration",
halfDay: "Half-day (<=5h)",
fullDay: "Full day (<=10h)",
multiDay: "Multi-day",
numberOfDays: "Number of days",
// -- Location & Client section
locationClient: "Location & Client",
locationClientDescription: "Geographic zone and service level",
geographicZone: "Geographic Zone",
selectZone: "Select a zone",
zoneCore: "Core (Montreal/Laval)",
zoneSecondary: "Greater Montreal",
zoneNorthPremium: "North Shore / Laurentians",
zoneExtended: "Outaouais / Mauricie",
zoneRedFlag: "Remote (Abitibi, Cote-Nord)",
premiumClientLevel: "Client Service Level",
premiumStandard: "Standard",
premiumStandardDesc: "Normal service",
premium1: "Premium 1",
premium1Desc: "Daily cleanup",
premium2: "Premium 2",
premium2Desc: "Lawn protection",
premium3: "Premium 3",
premium3Desc: "VIP / White-glove service",
surchargePerDay: "/day",
surchargeTBD: "Rate to be confirmed",
// -- Equipment & Supply Chain section
equipmentSupplyChain: "Equipment & Supply Chain",
equipmentSupplyChainDescription: "Required tools and material lead times",
toolsEquipment: "Tools & Equipment",
dailyCost: "/day",
supplyChainRisk: "Supply Chain Risk",
supplyStandard: "Standard",
supplyStandardDesc: "<=1 week",
supplyExtended: "Extended",
supplyExtendedDesc: "2-4 weeks",
supplyImport: "Import",
supplyImportDesc: "6-8 weeks",
supplyWarning: "Warning: Extended supply lead times may affect project scheduling.",
week: "week",
weeks: "weeks",
placeholderPricing: "Symbolic pricing - awaiting confirmation",
```

Make sure there are no trailing comma issues and that both fr.ts and en.ts have EXACTLY the same key names.
  </action>
  <verify>
1. `cd frontend && npx tsc --noEmit` — no TypeScript errors (Zod schema, types, and i18n keys all type-check)
2. Grep both i18n files for key count: `grep -c "compagnons\|halfDay\|zoneCore\|premium1\|supplyWarning\|toolsEquipment" frontend/src/lib/i18n/fr.ts` should return 6+, same for en.ts
3. Verify Zod schema compiles: `node -e "const z = require('zod'); console.log('OK')"` (basic check)
  </verify>
  <done>Frontend Zod schema validates all 7 new field groups. TypeScript HybridQuoteRequest interface has matching fields. Both fr.ts and en.ts have ~25 new keys each with real translations (not placeholder "TODO").</done>
</task>

</tasks>

<verification>
1. Backend schema validates existing requests (backward compat): `cd backend && python -c "from app.schemas.hybrid_quote import HybridQuoteRequest; HybridQuoteRequest(sqft=1000, category='Bardeaux', complexity_tier=2); print('Backward compat OK')"`
2. Backend schema validates new fields: `cd backend && python -c "from app.schemas.hybrid_quote import HybridQuoteRequest; r = HybridQuoteRequest(sqft=1000, category='Bardeaux', complexity_tier=2, employee_compagnons=3, duration_type='full_day', geographic_zone='core', premium_client_level='premium_1', equipment_items=['crane','dumpster'], supply_chain_risk='extended'); print('New fields OK:', r.employee_compagnons, r.geographic_zone)"`
3. Equipment config is valid JSON: `python -m json.tool backend/app/models/equipment_config.json`
4. Frontend TypeScript compiles: `cd frontend && npx tsc --noEmit`
5. RadioGroup component exists: `test -f frontend/src/components/ui/radio-group.tsx && echo "OK"`
6. i18n keys present in both languages: `grep "compagnons" frontend/src/lib/i18n/fr.ts frontend/src/lib/i18n/en.ts`
</verification>

<success_criteria>
- All 7 new field groups exist in HybridQuoteRequest Pydantic schema as Optional fields
- Equipment config JSON has 5 items with bilingual names
- Frontend Zod schema has 7 new field groups with correct defaults
- TypeScript HybridQuoteRequest interface has matching optional fields
- ~25 new i18n keys in fr.ts with Quebec French translations
- ~25 new i18n keys in en.ts with English translations
- RadioGroup component installed via shadcn CLI
- Zero TypeScript compilation errors
- Existing quote submission still works (backward compatibility)
</success_criteria>

<output>
After completion, create `.planning/phases/22-new-estimation-input-fields/22-01-SUMMARY.md`
</output>
