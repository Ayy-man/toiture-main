---
phase: 26-ux-overhaul-polish
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/src/components/estimateur/wizard/wizard-container.tsx
  - frontend/src/components/estimateur/wizard/step-basics.tsx
  - frontend/src/components/estimateur/wizard/step-complexity.tsx
  - frontend/src/components/estimateur/wizard/step-crew.tsx
  - frontend/src/components/estimateur/wizard/step-materials.tsx
  - frontend/src/components/estimateur/wizard/step-review.tsx
  - frontend/src/app/(admin)/estimateur/complet/page.tsx
  - frontend/src/lib/i18n/fr.ts
  - frontend/src/lib/i18n/en.ts
autonomous: true

must_haves:
  truths:
    - "FullQuoteForm displays as 5-step wizard with numbered progress indicator"
    - "User can navigate between steps with Back/Next buttons"
    - "Each step validates its fields before allowing Next"
    - "Step 5 shows read-only summary of all inputs"
    - "Generate AI Quote button on final step triggers API submission"
    - "Step transitions animate with slide left/right"
    - "Wizard works on mobile (responsive, bottom nav)"
  artifacts:
    - path: "frontend/src/components/estimateur/wizard/wizard-container.tsx"
      provides: "Step manager with progress bar, FormProvider, navigation"
      exports: ["WizardContainer"]
    - path: "frontend/src/components/estimateur/wizard/step-basics.tsx"
      provides: "Step 1: estimator, client, category, sqft, material/labor lines, features"
      exports: ["StepBasics"]
    - path: "frontend/src/components/estimateur/wizard/step-complexity.tsx"
      provides: "Step 2: TierSelector, FactorChecklist, manual extra hours"
      exports: ["StepComplexity"]
    - path: "frontend/src/components/estimateur/wizard/step-crew.tsx"
      provides: "Step 3: employee counts, duration, zone, premium level"
      exports: ["StepCrew"]
    - path: "frontend/src/components/estimateur/wizard/step-materials.tsx"
      provides: "Step 4: equipment items, supply chain risk"
      exports: ["StepMaterials"]
    - path: "frontend/src/components/estimateur/wizard/step-review.tsx"
      provides: "Step 5: read-only summary with Generate Quote button"
      exports: ["StepReview"]
  key_links:
    - from: "frontend/src/components/estimateur/wizard/wizard-container.tsx"
      to: "react-hook-form"
      via: "FormProvider wrapping all steps"
      pattern: "FormProvider|useForm"
    - from: "frontend/src/components/estimateur/wizard/step-complexity.tsx"
      to: "frontend/src/components/estimateur/tier-selector.tsx"
      via: "import TierSelector"
      pattern: "TierSelector"
    - from: "frontend/src/app/(admin)/estimateur/complet/page.tsx"
      to: "frontend/src/components/estimateur/wizard/wizard-container.tsx"
      via: "import WizardContainer"
      pattern: "WizardContainer"
---

<objective>
Transform the FullQuoteForm from a single-page accordion layout into a 5-step wizard form with progress indicator and step-by-step validation.

Purpose: UX-05 (multi-step wizard), UX-10 partial (framer-motion for step animations) -- the current form has 30+ fields which is overwhelming. A wizard breaks it into digestible steps.
Output: 5 wizard step components, wizard container with progress bar, framer-motion installed, complet page updated to use wizard.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/components/estimateur/full-quote-form.tsx
@frontend/src/lib/schemas/hybrid-quote.ts
@frontend/src/types/hybrid-quote.ts
@frontend/src/components/estimateur/tier-selector.tsx
@frontend/src/components/estimateur/factor-checklist.tsx
@frontend/src/components/estimateur/quote-result.tsx
@frontend/src/components/estimateur/submission-editor.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install framer-motion and create wizard infrastructure</name>
  <files>
    frontend/package.json
    frontend/src/components/estimateur/wizard/wizard-container.tsx
    frontend/src/lib/i18n/fr.ts
    frontend/src/lib/i18n/en.ts
  </files>
  <action>
1. **Install framer-motion**:
   - Run `cd frontend && pnpm add framer-motion`
   - Verify it appears in package.json dependencies.

2. **Add wizard i18n keys** to both `fr.ts` and `en.ts`:
   - Add a `wizard` section:
     ```
     wizard: {
       step1: "Projet" / "Project",
       step2: "Complexite" / "Complexity",
       step3: "Equipe" / "Crew",
       step4: "Equipement" / "Equipment",
       step5: "Revision" / "Review",
       next: "Suivant" / "Next",
       back: "Retour" / "Back",
       generateQuote: "Generer la soumission IA" / "Generate AI Quote",
       stepOf: "Etape {current} de {total}" / "Step {current} of {total}",
     }
     ```

3. **Create `WizardContainer`** at `frontend/src/components/estimateur/wizard/wizard-container.tsx`:
   - This is the main orchestrator component that:
     a. Creates the `useForm<HybridQuoteFormData>` with zodResolver (same defaults as current FullQuoteForm).
     b. Wraps everything in `<Form>` (from shadcn) which provides `<FormProvider>`.
     c. Manages `currentStep` state (0-4, zero-indexed internally but displayed as 1-5).
     d. Manages `direction` state (1 for forward, -1 for backward) for animation direction.
     e. Contains the `onSubmit` handler (moved from FullQuoteForm) that calls `submitHybridQuote`.
     f. Contains the `useTierData()` hook (move from FullQuoteForm) for tier/factor config.
     g. Manages `result` and `submission` state (same as current FullQuoteForm).

   - **Progress bar**: Horizontal bar at top with 5 steps.
     - Each step: numbered circle (1-5) + label text below.
     - Completed steps: `bg-primary text-primary-foreground` circle, `text-primary` label.
     - Current step: `bg-primary text-primary-foreground` circle with ring, `font-semibold` label.
     - Future steps: `bg-muted text-muted-foreground` circle, `text-muted-foreground` label.
     - Connecting line between circles: `bg-primary` for completed, `bg-muted` for future.
     - Completed steps are clickable (jump back).
     - On mobile (<sm): show only step number + current step label (not all labels).

   - **Step content area**: Uses framer-motion `AnimatePresence` with `mode="wait"`.
     - Each step renders with `motion.div` using:
       ```tsx
       initial={{ x: direction > 0 ? 300 : -300, opacity: 0 }}
       animate={{ x: 0, opacity: 1 }}
       exit={{ x: direction > 0 ? -300 : 300, opacity: 0 }}
       transition={{ type: "spring", stiffness: 300, damping: 30 }}
       ```
     - Key on `currentStep` for AnimatePresence.

   - **Navigation buttons**: Fixed bottom bar on mobile, inline below content on desktop.
     - Back button: disabled on step 0. `variant="outline"`.
     - Next button: runs per-step validation via `form.trigger(fieldNames)` before advancing.
     - Step 5 (review): Next button becomes "Generate AI Quote" submit button.

   - **Per-step validation fields** (passed to `form.trigger()`):
     - Step 0 (basics): ["sqft", "category", "material_lines", "labor_lines"]
     - Step 1 (complexity): ["complexity_tier"] (factor fields are all optional)
     - Step 2 (crew): [] (all optional)
     - Step 3 (equipment): [] (all optional)
     - Step 4 (review): no validation, just submit

   - **Result display**: After form submission, when `result` is set:
     - If no submission yet: show QuoteResult + "Create Submission" button (same as current FullQuoteForm).
     - If submission created: show SubmissionEditor.
     - Result replaces the wizard content (full width).

   - Import and render the 5 step components (StepBasics, StepComplexity, StepCrew, StepMaterials, StepReview) based on currentStep.
  </action>
  <verify>
    - Run `cd frontend && pnpm list framer-motion` -- version should be listed
    - Run `cd frontend && npx tsc --noEmit` -- TypeScript compiles (wizard-container alone, steps come in Task 2)
  </verify>
  <done>
    - framer-motion installed in frontend/package.json
    - WizardContainer created with progress bar, step management, form provider, animation, navigation
    - Wizard i18n keys added to fr.ts and en.ts
  </done>
</task>

<task type="auto">
  <name>Task 2: Create 5 wizard step components and wire into complet page</name>
  <files>
    frontend/src/components/estimateur/wizard/step-basics.tsx
    frontend/src/components/estimateur/wizard/step-complexity.tsx
    frontend/src/components/estimateur/wizard/step-crew.tsx
    frontend/src/components/estimateur/wizard/step-materials.tsx
    frontend/src/components/estimateur/wizard/step-review.tsx
    frontend/src/app/(admin)/estimateur/complet/page.tsx
  </files>
  <action>
1. **Create `StepBasics`** at `step-basics.tsx`:
   - Uses `useFormContext<HybridQuoteFormData>()` to access form (no props needed for form state).
   - Props: none (everything comes from form context).
   - Content: Extract from FullQuoteForm's "Project Details" Card section:
     - Estimator dropdown (created_by)
     - Sqft + Category (side-by-side grid)
     - Material lines + Labor lines (side-by-side grid)
     - Client name field (from submission.clientName i18n key) -- simple text Input, optional
     - Features section: has_chimney, has_skylights, has_subs Switches (from the "Features" accordion)
   - Wrap in a Card with header showing Calculator icon + "Project Details" title.
   - All fields use FormField/FormControl/FormLabel/FormMessage from shadcn form.

2. **Create `StepComplexity`** at `step-complexity.tsx`:
   - Props: `tiers: TierData[]`, `factorConfig: FactorConfig`, `calculatedFactorHours: number` (passed from WizardContainer which has useTierData).
   - Content: Extract from FullQuoteForm's "Complexity" accordion section:
     - TierSelector component (existing, reuse as-is)
     - FactorChecklist component (existing, reuse as-is)
     - Manual extra hours Input
   - Uses `useFormContext` to read/write form values.
   - Wrap in a Card with Layers icon + "Project Complexity" title.

3. **Create `StepCrew`** at `step-crew.tsx`:
   - Content: Extract from FullQuoteForm's "Crew & Duration" + "Location & Client" accordion sections:
     - Compagnons/Apprentis/Manoeuvres number inputs with total crew display
     - Duration type RadioGroup + conditional multi-day day picker
     - Geographic zone Select
     - Premium client level Select
   - Wrap in a Card. Two visual sections separated by a divider:
     - Top: "Crew & Duration" with Users icon
     - Bottom: "Location & Client" with MapPin icon

4. **Create `StepMaterials`** at `step-materials.tsx`:
   - Content: Extract from FullQuoteForm's "Equipment & Supply Chain" accordion section:
     - Equipment checklist with Checkbox items and daily costs
     - Supply chain risk RadioGroup
     - Conditional supply chain warning (AlertCircle banner)
   - Wrap in a Card with Package icon + "Equipment & Supply Chain" title.

5. **Create `StepReview`** at `step-review.tsx`:
   - Props: `tiers: TierData[]`, `factorConfig: FactorConfig`, `isLoading: boolean` (from WizardContainer).
   - Uses `useFormContext` to read all form values via `form.getValues()`.
   - Content: Read-only summary of ALL inputs organized in sections:
     - **Project**: category, sqft, estimator, material lines, labor lines, features (chimney/skylights/subs)
     - **Complexity**: tier name, selected factors with hours, manual extra hours, total hours
     - **Crew**: worker counts, duration, zone, premium level
     - **Equipment**: selected equipment items, supply chain risk
   - Each value displayed as `<dt>` label + `<dd>` value in a definition list layout or two-column grid.
   - "Generate AI Quote" button is NOT in this component -- it's in WizardContainer (the submit button in the navigation bar).
   - Show a subtle "Review your inputs before generating" message at the top.

6. **Update `complet/page.tsx`**:
   - Replace `<FullQuoteForm />` with `<WizardContainer />`.
   - Import WizardContainer from `@/components/estimateur/wizard/wizard-container`.
   - Remove the FullQuoteForm import.
   - Update the outer div to `max-w-4xl` (if not already done in 26-01 -- this plan is independent, so apply it here too).
   - The page should just render:
     ```tsx
     <div className="max-w-4xl">
       <h1 className="text-3xl font-bold tracking-tight mb-6">{t.nav.estimateur}</h1>
       <EstimateurTabs />
       <div className="mt-6">
         <WizardContainer />
       </div>
     </div>
     ```

IMPORTANT: The original `full-quote-form.tsx` should be preserved as-is (do not delete it). It can serve as reference and is not imported anywhere once complet/page.tsx is updated. If other pages import it, verify and handle.
  </action>
  <verify>
    - Run `cd frontend && npx next build` -- should compile without errors
    - Run `cd frontend && npx tsc --noEmit` -- TypeScript passes
    - Check that `full-quote-form.tsx` is no longer imported by `complet/page.tsx`
  </verify>
  <done>
    - 5 step components created with all form fields extracted from FullQuoteForm
    - Each step uses useFormContext (shared form state across all steps)
    - Step 5 (Review) shows read-only summary of all inputs
    - complet/page.tsx renders WizardContainer instead of FullQuoteForm
    - Progress bar shows 5 numbered steps with labels
    - Back/Next navigation with per-step validation
    - Step transitions animate with framer-motion slide left/right
    - Responsive on mobile with full-width steps
  </done>
</task>

</tasks>

<verification>
- Wizard renders 5 steps with progress indicator
- Can navigate forward/backward between steps
- Step 1 validates sqft and category before allowing Next
- Step 5 shows all inputs in read-only format
- Generate button submits form and shows QuoteResult
- Animations work for step transitions
- Build passes
</verification>

<success_criteria>
- FullQuoteForm displays as 5-step wizard with progress bar
- Each step validates before Next
- Step transitions are animated (framer-motion)
- Review step shows complete summary
- Generate AI Quote button works from step 5
- Works on both desktop and mobile
- framer-motion installed as dependency
</success_criteria>

<output>
After completion, create `.planning/phases/26-ux-overhaul-polish/26-03-SUMMARY.md`
</output>
