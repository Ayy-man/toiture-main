---
phase: 26-ux-overhaul-polish
plan: 04
type: execute
wave: 2
depends_on: ["26-03"]
files_modified:
  - frontend/src/components/estimateur/animated-price.tsx
  - frontend/src/components/estimateur/confidence-badge.tsx
  - frontend/src/components/estimateur/pricing-table.tsx
  - frontend/src/components/estimateur/quote-result.tsx
  - frontend/src/components/estimate-result.tsx
  - frontend/src/components/reasoning-display.tsx
  - frontend/src/components/similar-cases.tsx
  - frontend/src/lib/i18n/fr.ts
  - frontend/src/lib/i18n/en.ts
autonomous: true

must_haves:
  truths:
    - "AI result price animates from 0 to target value with counting effect"
    - "Confidence badge shows colored indicator (green/amber/red) with label"
    - "3-tier pricing table displays Basic/Standard/Premium side-by-side with recommended highlight"
    - "Reasoning display is collapsible with streaming animation"
    - "Similar cases display as grid of mini-cards with similarity percentage"
    - "Result components reveal with staggered animation"
  artifacts:
    - path: "frontend/src/components/estimateur/animated-price.tsx"
      provides: "Counting animation from 0 to target price"
      exports: ["AnimatedPrice"]
    - path: "frontend/src/components/estimateur/confidence-badge.tsx"
      provides: "Colored badge for HIGH/MEDIUM/LOW confidence"
      exports: ["ConfidenceBadge"]
    - path: "frontend/src/components/estimateur/pricing-table.tsx"
      provides: "3-column tier pricing display"
      exports: ["PricingTable"]
  key_links:
    - from: "frontend/src/components/estimateur/quote-result.tsx"
      to: "frontend/src/components/estimateur/animated-price.tsx"
      via: "import AnimatedPrice"
      pattern: "AnimatedPrice"
    - from: "frontend/src/components/estimateur/quote-result.tsx"
      to: "frontend/src/components/estimateur/pricing-table.tsx"
      via: "import PricingTable"
      pattern: "PricingTable"
    - from: "frontend/src/components/estimateur/quote-result.tsx"
      to: "frontend/src/components/estimateur/confidence-badge.tsx"
      via: "import ConfidenceBadge"
      pattern: "ConfidenceBadge"
---

<objective>
Create animated AI result display components: counting price animation, confidence badge, 3-tier pricing table, redesigned reasoning display, and similar cases grid.

Purpose: UX-06 (animated price, confidence badge, pricing table), UX-07 (collapsible reasoning with streaming) -- transforms the static quote result into an engaging, informative display.
Output: AnimatedPrice, ConfidenceBadge, PricingTable components, redesigned QuoteResult, ReasoningDisplay, SimilarCases.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/components/estimateur/quote-result.tsx
@frontend/src/components/estimate-result.tsx
@frontend/src/components/reasoning-display.tsx
@frontend/src/components/similar-cases.tsx
@frontend/src/types/hybrid-quote.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AnimatedPrice, ConfidenceBadge, and PricingTable components</name>
  <files>
    frontend/src/components/estimateur/animated-price.tsx
    frontend/src/components/estimateur/confidence-badge.tsx
    frontend/src/components/estimateur/pricing-table.tsx
    frontend/src/lib/i18n/fr.ts
    frontend/src/lib/i18n/en.ts
  </files>
  <action>
1. **Create `AnimatedPrice`** at `frontend/src/components/estimateur/animated-price.tsx`:
   - Props: `value: number`, `prefix?: string` (default "$"), `locale?: string` (default "fr-CA"), `duration?: number` (default 1.5 seconds), `className?: string`.
   - Use framer-motion `useSpring` and `useTransform`:
     ```tsx
     const springValue = useSpring(0, { stiffness: 50, damping: 15 });
     const display = useTransform(springValue, (v) =>
       new Intl.NumberFormat(locale, { style: "currency", currency: "CAD", minimumFractionDigits: 0 }).format(Math.round(v))
     );

     useEffect(() => { springValue.set(value); }, [value, springValue]);
     ```
   - Render: `<motion.span className={className}>{display}</motion.span>` using `useMotionValueEvent` to update a displayed value state.
   - Alternative simpler approach if useTransform doesn't render well: use `useMotionValue` + `useMotionValueEvent` to update a React state:
     ```tsx
     const [displayValue, setDisplayValue] = useState(0);
     const motionValue = useSpring(0, { stiffness: 50, damping: 15 });
     useMotionValueEvent(motionValue, "change", (v) => setDisplayValue(Math.round(v)));
     useEffect(() => { motionValue.set(value); }, [value]);
     return <span className={className}>{formatCurrency(displayValue)}</span>;
     ```

2. **Create `ConfidenceBadge`** at `frontend/src/components/estimateur/confidence-badge.tsx`:
   - Props: `confidence: number` (0-1 float), `className?: string`.
   - Logic:
     - confidence >= 0.7: HIGH -- green bg, CheckCircle icon, "HIGH" / "ELEVEE" label
     - confidence >= 0.4: MEDIUM -- amber bg, Info icon, "MEDIUM" / "MOYENNE" label
     - confidence < 0.4: LOW -- red bg, AlertTriangle icon, "LOW" / "FAIBLE" label
   - Uses `useLanguage()` for labels from `t.resultat.haute/moyenne/faible`.
   - Render: Badge-like element with rounded-full, icon + percentage + label.
     ```tsx
     <div className={cn("inline-flex items-center gap-1.5 rounded-full px-3 py-1 text-xs font-semibold", colorClasses, className)}>
       <Icon className="size-3.5" />
       <span>{Math.round(confidence * 100)}%</span>
       <span>{label}</span>
     </div>
     ```
   - Color classes:
     - HIGH: `bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400`
     - MEDIUM: `bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400`
     - LOW: `bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400`

3. **Create `PricingTable`** at `frontend/src/components/estimateur/pricing-table.tsx`:
   - Props: `tiers: PricingTier[]` (from HybridQuoteResponse.pricing_tiers), `recommendedTier?: string` (default "Standard"), `className?: string`.
   - Layout: 3-column grid (`grid grid-cols-3 gap-3`).
   - Each tier column is a Card:
     - Header: tier name (Basic/Standard/Premium), markup percentage below
     - Body: total price (large, bold), labor cost, materials cost
     - Recommended tier: has a `ring-2 ring-primary` border and a "Recommended" / "Recommande" badge at top.
   - Format all prices with fr-CA locale (CAD currency).
   - On mobile (<sm): stack vertically or use a horizontal scroll.
   - Uses `useLanguage()` for the "Recommended" label.

4. **Add i18n keys**:
   - `fullQuote.recommended`: "Recommande" / "Recommended"
   - `fullQuote.basic`: "De base" / "Basic"
   - `fullQuote.standard`: "Standard" / "Standard"
   - `fullQuote.premium`: "Premium" / "Premium"
   - `fullQuote.markup`: "Majoration" / "Markup"
   - `fullQuote.analyzedIn`: "Analyse en {seconds} secondes" / "Analyzed in {seconds} seconds"
   - `fullQuote.showReasoning`: "Voir le raisonnement" / "Show reasoning"
   - `fullQuote.hideReasoning`: "Masquer le raisonnement" / "Hide reasoning"
  </action>
  <verify>
    - Run `cd frontend && npx tsc --noEmit` -- TypeScript compiles
    - AnimatedPrice renders a counting animation (verified by code review)
    - ConfidenceBadge colors match the three thresholds
    - PricingTable renders 3 columns
  </verify>
  <done>
    - AnimatedPrice component with framer-motion spring counting animation
    - ConfidenceBadge with 3 color levels (green/amber/red) and icon
    - PricingTable with 3-column tier display and recommended highlight
    - All components bilingual via i18n
  </done>
</task>

<task type="auto">
  <name>Task 2: Redesign QuoteResult, ReasoningDisplay, SimilarCases, and EstimateResult</name>
  <files>
    frontend/src/components/estimateur/quote-result.tsx
    frontend/src/components/estimate-result.tsx
    frontend/src/components/reasoning-display.tsx
    frontend/src/components/similar-cases.tsx
  </files>
  <action>
1. **Redesign `QuoteResult`** (`frontend/src/components/estimateur/quote-result.tsx`):
   - Read the existing component thoroughly first.
   - Replace the current static display with animated components:
   - Structure (inside Card):
     a. **Animated price hero**: `<AnimatedPrice value={standardTier.total_price} className="text-4xl font-bold" />` at the top, centered.
     b. **Confidence badge**: `<ConfidenceBadge confidence={quote.overall_confidence} />` below price.
     c. **Pricing tiers**: `<PricingTable tiers={quote.pricing_tiers} recommendedTier="Standard" />` showing all 3 tiers.
     d. **Work items table**: Keep existing work items list (unchanged -- already clean).
     e. **Summary section**: Keep materials/labor/total breakdown (unchanged).
     f. **Reasoning**: Keep existing Collapsible reasoning (will be enhanced separately below for the EstimateResult flow -- the QuoteResult already has a decent collapsible).
     g. **QuoteActions and FeedbackPanel**: Keep at bottom (unchanged).
   - **Staggered animation**: Wrap sections in `motion.div` with staggered delays:
     ```tsx
     <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0 }}>
       {/* Animated price */}
     </motion.div>
     <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}>
       {/* Confidence badge */}
     </motion.div>
     <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }}>
       {/* Pricing table */}
     </motion.div>
     ```
   - Remove the confidence warning banner (replaced by ConfidenceBadge which is always visible).
   - Remove hardcoded French strings -- use `t.fullQuote.*` keys for all labels.

2. **Redesign `EstimateResult`** (`frontend/src/components/estimate-result.tsx`):
   - This is the Prix tab (quick estimate) result. Currently shows plain `$X` text.
   - Replace with:
     - `<AnimatedPrice value={result.estimate} className="text-4xl font-bold" />`
     - `<ConfidenceBadge confidence={confidenceToNumber(result.confidence)} />` where confidenceToNumber maps HIGH=0.85, MEDIUM=0.55, LOW=0.25.
     - Price range displayed as subtitle: `${result.range_low} - ${result.range_high}`
   - Replace hardcoded `text-green-600`, `text-yellow-600`, `text-red-600` with ConfidenceBadge (removes UX-11 color issue for this component).
   - Add `motion.div` fade-in animation.

3. **Redesign `ReasoningDisplay`** (`frontend/src/components/reasoning-display.tsx`):
   - Transform from always-visible Card to collapsible panel:
   - When collapsed: show a clickable bar with "AI Reasoning" title + "Analyzed in X seconds" subtitle + ChevronDown icon.
   - When expanded: show the markdown content.
   - While streaming (isStreaming=true): show animated dots (3 dots with staggered pulse) before the text, and auto-expand.
   - Add a processing time prop: `processingTime?: number` (seconds).
   - Use shadcn Collapsible (already imported in quote-result).
   - Streaming dots animation: 3 small circles with `motion.span` and staggered animation:
     ```tsx
     {[0, 1, 2].map((i) => (
       <motion.span
         key={i}
         className="inline-block h-2 w-2 rounded-full bg-primary"
         animate={{ opacity: [0.3, 1, 0.3] }}
         transition={{ duration: 1, repeat: Infinity, delay: i * 0.2 }}
       />
     ))}
     ```

4. **Redesign `SimilarCases`** (`frontend/src/components/similar-cases.tsx`):
   - Transform from stacked list to grid of mini-cards:
   - Layout: `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3`.
   - Each card: small Card with:
     - Category name + year at top (font-medium)
     - Similarity percentage as a colored badge (using same green/amber thresholds as confidence)
     - Sqft value
     - Total price
     - Per-sqft price
   - Remove the border-b divider stacking pattern.
   - Add `motion.div` with stagger for card reveal.
  </action>
  <verify>
    - Run `cd frontend && npx next build` -- no compile errors
    - Verify AnimatedPrice is used in both QuoteResult and EstimateResult
    - Verify no hardcoded French strings remain in QuoteResult (all use i18n)
    - Verify framer-motion imports work (depends on 26-03 installing it)
  </verify>
  <done>
    - QuoteResult shows animated price, confidence badge, 3-tier pricing table with staggered reveal
    - EstimateResult (Prix tab) shows animated price and confidence badge
    - ReasoningDisplay is collapsible with streaming dots animation
    - SimilarCases displays as a card grid with similarity badges
    - All hardcoded French/color strings removed from result components
  </done>
</task>

</tasks>

<verification>
- QuoteResult renders with: animated counting price, colored confidence badge, 3-column pricing table
- EstimateResult renders with: animated price, confidence badge (replaces hardcoded color classes)
- ReasoningDisplay is collapsible and shows streaming dots while loading
- SimilarCases renders as card grid instead of stacked list
- Build passes, TypeScript clean
</verification>

<success_criteria>
- AI result price counts up from 0 to target with smooth animation
- Confidence badge is always visible with green/amber/red coloring
- 3-tier pricing table shows Basic/Standard/Premium with recommended highlight
- Reasoning is collapsible with streaming animation
- Similar cases display as mini-card grid
- Staggered animation on result reveal
- Works in both light and dark mode
</success_criteria>

<output>
After completion, create `.planning/phases/26-ux-overhaul-polish/26-04-SUMMARY.md`
</output>
