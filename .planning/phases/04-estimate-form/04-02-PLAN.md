---
phase: 04-estimate-form
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - frontend/src/components/estimate-form.tsx
  - frontend/src/components/estimate-result.tsx
  - frontend/src/components/similar-cases.tsx
  - frontend/src/components/reasoning-display.tsx
  - frontend/src/app/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can see form with all 6 input fields"
    - "User can submit form and see loading state"
    - "User can see estimate with range and confidence after submit"
    - "User can see similar historical cases"
    - "User can see LLM reasoning in markdown format"
    - "Invalid inputs show validation errors"
  artifacts:
    - path: "frontend/src/components/estimate-form.tsx"
      provides: "Main form component with all 6 fields"
      min_lines: 100
    - path: "frontend/src/components/estimate-result.tsx"
      provides: "Estimate display with range and confidence"
      min_lines: 30
    - path: "frontend/src/components/similar-cases.tsx"
      provides: "Similar cases list display"
      min_lines: 40
    - path: "frontend/src/components/reasoning-display.tsx"
      provides: "Markdown reasoning display"
      min_lines: 20
  key_links:
    - from: "frontend/src/components/estimate-form.tsx"
      to: "frontend/src/lib/api.ts"
      via: "submitEstimate import"
      pattern: "import.*submitEstimate.*from.*api"
    - from: "frontend/src/components/estimate-form.tsx"
      to: "frontend/src/lib/schemas.ts"
      via: "schema import"
      pattern: "import.*estimateFormSchema.*from.*schemas"
    - from: "frontend/src/app/page.tsx"
      to: "frontend/src/components/estimate-form.tsx"
      via: "component import"
      pattern: "import.*EstimateForm"
---

<objective>
Build the estimate form UI with all 6 input fields, API integration, and result display components.

Purpose: Enable users to input job details and receive AI-powered estimates with similar cases and reasoning.

Output: Complete estimate form flow - input, submit, loading, display results (estimate, similar cases, reasoning).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-estimate-form/04-RESEARCH.md

# From Plan 01
@frontend/src/lib/schemas.ts
@frontend/src/lib/api.ts

# shadcn components
@frontend/src/components/ui/form.tsx
@frontend/src/components/ui/card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create result display components</name>
  <files>
    frontend/src/components/estimate-result.tsx
    frontend/src/components/similar-cases.tsx
    frontend/src/components/reasoning-display.tsx
  </files>
  <action>
    Create src/components/estimate-result.tsx:
    - "use client" directive
    - Import Card, CardContent, CardDescription, CardHeader, CardTitle from ui/card
    - Import EstimateResponse from lib/api
    - Props: result: EstimateResponse
    - Display estimate as large dollar amount with toLocaleString()
    - Show range_low - range_high in CardDescription
    - Color-coded confidence badge:
      - HIGH: text-green-600
      - MEDIUM: text-yellow-600
      - LOW: text-red-600
    - Show model name in muted text

    Create src/components/similar-cases.tsx:
    - "use client" directive
    - Import Card components
    - Import SimilarCase from lib/api
    - Props: cases: SimilarCase[]
    - Handle empty state: "No similar cases found."
    - Map over cases showing:
      - Category and year
      - Square footage
      - Total price and per_sqft
      - Similarity percentage (similarity * 100).toFixed(0)%
    - Use border-b for visual separation between cases

    Create src/components/reasoning-display.tsx:
    - "use client" directive
    - Import Markdown from react-markdown
    - Import Card components
    - Props: reasoning: string | null
    - Return null if reasoning is falsy
    - Render markdown in prose styles: "prose prose-sm max-w-none dark:prose-invert"
    - Card title: "AI Reasoning"
  </action>
  <verify>
    ```bash
    cd /Users/aymanbaig/Desktop/Toiture-P1/frontend
    pnpm tsc --noEmit
    ```
    Components compile without type errors.
  </verify>
  <done>Three result display components created: estimate-result.tsx, similar-cases.tsx, reasoning-display.tsx</done>
</task>

<task type="auto">
  <name>Task 2: Create estimate form component</name>
  <files>
    frontend/src/components/estimate-form.tsx
    frontend/src/app/page.tsx
  </files>
  <action>
    Create src/components/estimate-form.tsx:
    - "use client" directive
    - Import useState from react
    - Import useForm from react-hook-form
    - Import zodResolver from @hookform/resolvers/zod
    - Import Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage from ui/form
    - Import Input, Select, SelectContent, SelectItem, SelectTrigger, SelectValue from ui components
    - Import Slider, Switch, Button from ui components
    - Import estimateFormSchema, EstimateFormData, CATEGORIES from lib/schemas
    - Import submitEstimate, EstimateResponse from lib/api
    - Import EstimateResult, SimilarCases, ReasoningDisplay components

    State:
    - result: EstimateResponse | null (null initially)
    - isLoading: boolean (false initially)
    - error: string | null (null initially)

    Form setup:
    - useForm with zodResolver(estimateFormSchema)
    - defaultValues:
      - sqft: 1500
      - category: "Bardeaux"
      - material_lines: 5
      - labor_lines: 2
      - has_subs: false
      - complexity: 10

    onSubmit handler:
    - Set isLoading true, error null
    - try: await submitEstimate(data), setResult
    - catch: setError with message
    - finally: setIsLoading false

    Form fields (6 total):
    1. sqft - Input type="number" with description "Total roof area in square feet"
    2. category - Select dropdown with CATEGORIES.map
    3. material_lines - Input type="number" with description "Number of material line items"
    4. labor_lines - Input type="number" with description "Number of labor line items"
    5. has_subs - Switch with description "Will this job involve subcontractors?"
    6. complexity - Slider min=1 max=100, show current value in label, description "Job complexity (1 = simple, 100 = very complex)"

    Submit button:
    - Disabled when isLoading
    - Text: isLoading ? "Getting Estimate..." : "Get Estimate"

    Error display:
    - Show error in red text if error state is set

    Results display (below form):
    - If result is not null:
      - <EstimateResult result={result} />
      - <SimilarCases cases={result.similar_cases} />
      - <ReasoningDisplay reasoning={result.reasoning} />

    Update src/app/page.tsx:
    - Import EstimateForm
    - Layout: container mx-auto py-8 px-4 max-w-2xl
    - h1 with title "TOITURELV Cortex"
    - p with description
    - <EstimateForm />
  </action>
  <verify>
    ```bash
    cd /Users/aymanbaig/Desktop/Toiture-P1/frontend
    pnpm tsc --noEmit && pnpm build
    ```
    TypeScript compiles and build succeeds.
  </verify>
  <done>EstimateForm component with all 6 fields, form validation, API integration, and result display</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete estimate form with all 6 inputs, backend integration, and result display (estimate, similar cases, reasoning)</what-built>
  <how-to-verify>
    1. Start backend in one terminal:
       ```bash
       cd /Users/aymanbaig/Desktop/Toiture-P1/backend
       uvicorn app.main:app --reload
       ```

    2. Start frontend in another terminal:
       ```bash
       cd /Users/aymanbaig/Desktop/Toiture-P1/frontend
       pnpm dev
       ```

    3. Open http://localhost:3000

    4. Verify form displays all 6 fields:
       - Square footage (number input)
       - Category (dropdown with options)
       - Material lines (number input)
       - Labor lines (number input)
       - Has subcontractors (toggle switch)
       - Complexity (slider with value display)

    5. Submit with default values:
       - Loading state shows "Getting Estimate..."
       - Result displays estimate amount, range, confidence
       - Similar cases section appears (may be empty if Pinecone not configured)
       - Reasoning section appears (may be null if LLM not configured)

    6. Test validation:
       - Clear sqft field and submit - should show error
       - Enter negative number for sqft - should show error

    Expected behavior: Form submits successfully and displays ML estimate result from backend.
  </how-to-verify>
  <resume-signal>Type "approved" to confirm form works correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. `ls frontend/src/components/estimate-form.tsx` - Form component exists
2. `ls frontend/src/components/estimate-result.tsx` - Result component exists
3. `ls frontend/src/components/similar-cases.tsx` - Similar cases component exists
4. `ls frontend/src/components/reasoning-display.tsx` - Reasoning component exists
5. `grep "EstimateForm" frontend/src/app/page.tsx` - Form integrated in page
6. `cd frontend && pnpm build` - Production build succeeds
</verification>

<success_criteria>
- FORM-01: Form renders with all 6 input fields (sqft, category, material_lines, labor_lines, has_subs, complexity)
- FORM-02: Submit button calls backend /estimate endpoint
- FORM-03: Estimate result displays estimate, range_low, range_high, confidence
- FORM-04: Similar cases displayed in card list
- FORM-05: LLM reasoning displayed with markdown formatting
- Form validation shows errors for invalid inputs
- Loading state displayed during API call
</success_criteria>

<output>
After completion, create `.planning/phases/04-estimate-form/04-02-SUMMARY.md`
</output>
