---
phase: 04-estimate-form
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/src/app/layout.tsx
  - frontend/src/app/page.tsx
  - frontend/src/app/globals.css
  - frontend/src/lib/utils.ts
  - frontend/src/lib/schemas.ts
  - frontend/src/lib/api.ts
  - frontend/tailwind.config.ts
  - frontend/components.json
  - frontend/.env.local
autonomous: true

must_haves:
  truths:
    - "Next.js dev server starts without errors"
    - "shadcn/ui components installed and usable"
    - "Zod schemas match backend API contract"
    - "API client can format requests correctly"
  artifacts:
    - path: "frontend/package.json"
      provides: "Next.js 15 with all dependencies"
      contains: "next"
    - path: "frontend/src/lib/schemas.ts"
      provides: "Zod validation schemas"
      exports: ["estimateFormSchema", "EstimateFormData", "CATEGORIES"]
    - path: "frontend/src/lib/api.ts"
      provides: "Typed API client"
      exports: ["submitEstimate", "EstimateResponse", "SimilarCase"]
    - path: "frontend/components.json"
      provides: "shadcn/ui configuration"
      contains: "shadcn"
  key_links:
    - from: "frontend/src/lib/api.ts"
      to: "NEXT_PUBLIC_API_URL"
      via: "environment variable"
      pattern: "process.env.NEXT_PUBLIC_API_URL"
    - from: "frontend/src/lib/schemas.ts"
      to: "backend/app/schemas/estimate.py"
      via: "matching validation rules"
      pattern: "z.coerce.number"
---

<objective>
Create Next.js 15 project with shadcn/ui, configure TypeScript schemas and API client for backend integration.

Purpose: Establish frontend foundation with proper typing and validation that matches the FastAPI backend contract.

Output: Runnable Next.js app with all dependencies, Zod schemas mirroring backend, and typed API client ready for form integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-estimate-form/04-RESEARCH.md

# Backend API contract
@backend/app/schemas/estimate.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Next.js project with shadcn/ui</name>
  <files>
    frontend/package.json
    frontend/src/app/layout.tsx
    frontend/src/app/page.tsx
    frontend/src/app/globals.css
    frontend/src/lib/utils.ts
    frontend/tailwind.config.ts
    frontend/components.json
    frontend/.env.local
  </files>
  <action>
    Create Next.js 15 project using pnpm:
    ```bash
    cd /Users/aymanbaig/Desktop/Toiture-P1
    pnpm create next-app@latest frontend --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --use-pnpm
    ```

    Initialize shadcn/ui (from frontend directory):
    ```bash
    cd frontend
    pnpm dlx shadcn@latest init -y
    ```

    Add required shadcn components:
    ```bash
    pnpm dlx shadcn@latest add form input select slider switch button card label
    ```

    Install additional dependencies:
    ```bash
    pnpm add react-markdown zod @hookform/resolvers
    ```

    Create .env.local with:
    ```
    NEXT_PUBLIC_API_URL=http://localhost:8000
    ```

    Update src/app/layout.tsx metadata:
    - title: "TOITURELV Cortex"
    - description: "AI-powered roofing price estimates"

    Update src/app/page.tsx with placeholder:
    - h1: "TOITURELV Cortex"
    - p: "AI-powered roofing price estimates"
    - (Form component will be added in Plan 02)
  </action>
  <verify>
    ```bash
    cd /Users/aymanbaig/Desktop/Toiture-P1/frontend
    pnpm dev &
    sleep 5
    curl -s http://localhost:3000 | grep -q "TOITURELV"
    pkill -f "next dev"
    ```
    Dev server starts and page loads with title.
  </verify>
  <done>Next.js 15 project created with shadcn/ui components installed, dev server runs on localhost:3000</done>
</task>

<task type="auto">
  <name>Task 2: Create Zod schemas and API client</name>
  <files>
    frontend/src/lib/schemas.ts
    frontend/src/lib/api.ts
    frontend/src/types/estimate.ts
  </files>
  <action>
    Create src/lib/schemas.ts with Zod validation:
    - CATEGORIES array matching backend ALLOWED_CATEGORIES (use "Elastomere" without accent for frontend, backend normalizes)
    - estimateFormSchema with z.coerce for number fields
    - sqft: z.coerce.number().positive().max(100000)
    - category: z.enum(CATEGORIES)
    - material_lines: z.coerce.number().int().min(0).max(100)
    - labor_lines: z.coerce.number().int().min(0).max(50)
    - has_subs: z.boolean()
    - complexity: z.coerce.number().int().min(1).max(100)
    - Export EstimateFormData type via z.infer

    Create src/lib/api.ts with typed API client:
    - API_URL from process.env.NEXT_PUBLIC_API_URL with fallback to "http://localhost:8000"
    - SimilarCase interface matching backend schema:
      - case_id: string
      - similarity: number
      - category: string | null
      - sqft: number | null
      - total: number | null
      - per_sqft: number | null
      - year: number | null
    - EstimateResponse interface:
      - estimate: number
      - range_low: number
      - range_high: number
      - confidence: "HIGH" | "MEDIUM" | "LOW"
      - model: string
      - similar_cases: SimilarCase[]
      - reasoning: string | null
    - submitEstimate function:
      - Accepts EstimateFormData
      - Converts has_subs boolean to 0/1 for backend
      - POSTs to ${API_URL}/estimate
      - Returns EstimateResponse
      - Throws Error with detail message on failure

    Create src/types/estimate.ts re-exporting from lib files for cleaner imports.
  </action>
  <verify>
    TypeScript compilation check:
    ```bash
    cd /Users/aymanbaig/Desktop/Toiture-P1/frontend
    pnpm tsc --noEmit
    ```
    No type errors.
  </verify>
  <done>Zod schemas match backend validation, API client typed correctly with has_subs boolean-to-int conversion</done>
</task>

</tasks>

<verification>
1. `ls frontend/package.json` - Next.js project exists
2. `ls frontend/src/components/ui/form.tsx` - shadcn Form component installed
3. `grep "NEXT_PUBLIC_API_URL" frontend/.env.local` - Environment configured
4. `grep "estimateFormSchema" frontend/src/lib/schemas.ts` - Schema exported
5. `grep "submitEstimate" frontend/src/lib/api.ts` - API client exported
6. `cd frontend && pnpm tsc --noEmit` - No TypeScript errors
</verification>

<success_criteria>
- Next.js 15 dev server runs without errors
- All 8 shadcn/ui components installed (form, input, select, slider, switch, button, card, label)
- Zod schemas enforce same constraints as backend Pydantic
- API client converts boolean has_subs to 0/1
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-estimate-form/04-01-SUMMARY.md`
</output>
