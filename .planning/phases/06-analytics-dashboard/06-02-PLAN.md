---
phase: 06-analytics-dashboard
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - frontend/src/components/dashboard/accuracy-chart.tsx
  - frontend/src/components/dashboard/confidence-chart.tsx
  - frontend/src/components/dashboard/category-breakdown.tsx
  - frontend/src/components/dashboard/stats-cards.tsx
  - frontend/src/components/dashboard/time-filter.tsx
  - frontend/src/components/dashboard/dashboard-content.tsx
  - frontend/src/app/dashboard/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can see accuracy percentages (within 10% and 20% of Laurent's prices)"
    - "User can see confidence vs accuracy correlation"
    - "User can see category distribution breakdown"
    - "User can filter by time period (7d, 30d, all time)"
    - "Dashboard shows loading states while data fetches"
    - "Dashboard shows empty states when no data exists"
  artifacts:
    - path: "frontend/src/components/dashboard/accuracy-chart.tsx"
      provides: "DASH-01: Accuracy bar chart showing % within thresholds"
      exports: ["AccuracyChart"]
    - path: "frontend/src/components/dashboard/confidence-chart.tsx"
      provides: "DASH-02: Confidence vs accuracy grouped bar chart"
      exports: ["ConfidenceChart"]
    - path: "frontend/src/components/dashboard/category-breakdown.tsx"
      provides: "DASH-03: Pie/donut chart of estimate categories"
      exports: ["CategoryBreakdown"]
    - path: "frontend/src/components/dashboard/stats-cards.tsx"
      provides: "DASH-04: KPI cards (total, reviewed, accuracy %)"
      exports: ["StatsCards"]
    - path: "frontend/src/components/dashboard/time-filter.tsx"
      provides: "DASH-04: Time period toggle (7d, 30d, all)"
      exports: ["TimeFilter"]
    - path: "frontend/src/app/dashboard/page.tsx"
      provides: "Dashboard route at /dashboard"
      min_lines: 20
  key_links:
    - from: "frontend/src/components/dashboard/dashboard-content.tsx"
      to: "frontend/src/lib/hooks/use-analytics.ts"
      via: "useAccuracyStats, useCategoryBreakdown, useConfidenceAccuracy hooks"
      pattern: "use(AccuracyStats|CategoryBreakdown|ConfidenceAccuracy)"
    - from: "frontend/src/components/dashboard/accuracy-chart.tsx"
      to: "@/components/ui/chart"
      via: "ChartContainer, ChartTooltip imports"
      pattern: "ChartContainer"
---

<objective>
Create the analytics dashboard UI with charts for accuracy, confidence correlation, category breakdown, and summary statistics with time filtering.

Purpose: Fulfill DASH-01 through DASH-04 requirements - give the team visibility into AI estimate accuracy so they can track improvement over time.

Output: A /dashboard page showing accuracy percentages, confidence trends, category distribution, and basic stats with working time period filters.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-analytics-dashboard/06-RESEARCH.md
@.planning/phases/06-analytics-dashboard/06-01-SUMMARY.md

# Analytics hooks and types from Plan 01
@frontend/src/lib/hooks/use-analytics.ts
@frontend/src/types/analytics.ts
@frontend/src/components/ui/chart.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dashboard chart components</name>
  <files>
    frontend/src/components/dashboard/accuracy-chart.tsx
    frontend/src/components/dashboard/confidence-chart.tsx
    frontend/src/components/dashboard/category-breakdown.tsx
    frontend/src/components/dashboard/stats-cards.tsx
    frontend/src/components/dashboard/time-filter.tsx
  </files>
  <action>
1. Create frontend/src/components/dashboard/accuracy-chart.tsx (DASH-01):
   - "use client" directive
   - Import Bar, BarChart, CartesianGrid, XAxis, YAxis from recharts
   - Import ChartContainer, ChartTooltip, ChartTooltipContent, ChartConfig from @/components/ui/chart
   - Import Card, CardContent, CardHeader, CardTitle, CardDescription from @/components/ui/card
   - Props: { accuracy10: number, accuracy20: number, totalReviewed: number }
   - ChartConfig with accuracy10 (chart-1 color, "Within 10%") and accuracy20 (chart-2 color, "Within 20%")
   - Handle empty state: if totalReviewed === 0, show "No reviewed estimates yet" message
   - Horizontal bar chart with percentages (0-100 domain), legend showing both thresholds
   - Use min-h-[200px] on ChartContainer

2. Create frontend/src/components/dashboard/confidence-chart.tsx (DASH-02):
   - "use client" directive
   - Props: { data: ConfidenceAccuracy[] } (HIGH/MEDIUM/LOW confidence with accuracy percentages)
   - Grouped bar chart: X-axis = confidence level, Y-axis = accuracy %, two bars per group (10%, 20%)
   - Handle empty data with message
   - ChartConfig for accuracy10 and accuracy20
   - Use min-h-[300px] on ChartContainer

3. Create frontend/src/components/dashboard/category-breakdown.tsx (DASH-03):
   - "use client" directive
   - Props: { data: CategoryBreakdown[] }
   - Import PieChart, Pie, Cell from recharts
   - Donut chart (innerRadius=60, outerRadius=100) showing estimate count by category
   - Labels show percentage on each slice
   - Color mapping: Bardeaux=chart-1, Elastomere=chart-2, Other=chart-3, "Service Call"=chart-4, Gutters=chart-5
   - Handle empty data with message
   - Use min-h-[300px] on ChartContainer

4. Create frontend/src/components/dashboard/stats-cards.tsx (DASH-04 partial):
   - "use client" directive
   - Props: { totalEstimates, reviewedCount, accuracy10, accuracy20: number }
   - Import Card, CardContent, CardHeader, CardTitle from @/components/ui/card
   - Import TrendingUp, TrendingDown, CheckCircle from lucide-react
   - 4-card grid (responsive: 1 col mobile, 2 cols md, 4 cols lg)
   - Cards: Total Estimates, Reviewed (with pending count), Within 10%, Within 20%
   - Color indicators: green TrendingUp if accuracy10 >= 50 or accuracy20 >= 70, else red TrendingDown

5. Create frontend/src/components/dashboard/time-filter.tsx (DASH-04 partial):
   - "use client" directive
   - Props: { value: TimePeriod, onChange: (value: TimePeriod) => void }
   - Import ToggleGroup, ToggleGroupItem from @/components/ui/toggle-group
   - Three options: "7 Days", "30 Days", "All Time"
   - Use type="single", handle empty value by not calling onChange
  </action>
  <verify>
    Run `cd frontend && pnpm tsc --noEmit` - should pass.
    Verify all 5 component files exist in frontend/src/components/dashboard/.
  </verify>
  <done>
    All chart components created with proper shadcn/ui chart patterns, empty state handling, and responsive layouts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create dashboard page and content wrapper</name>
  <files>
    frontend/src/components/dashboard/dashboard-content.tsx
    frontend/src/app/dashboard/page.tsx
  </files>
  <action>
1. Create frontend/src/components/dashboard/dashboard-content.tsx:
   - "use client" directive (hooks require client component)
   - Import useState from react
   - Import all dashboard components (AccuracyChart, ConfidenceChart, CategoryBreakdown, StatsCards, TimeFilter)
   - Import analytics hooks (useAccuracyStats, useCategoryBreakdown, useConfidenceAccuracy)
   - Import TimePeriod type
   - State: const [period, setPeriod] = useState<TimePeriod>("30d")
   - Call all three hooks with period
   - Handle loading state: show skeleton/loading spinner if any query is loading
   - Handle error state: show error message if any query has error
   - Render layout:
     - Header with title "Analytics Dashboard" and TimeFilter
     - StatsCards row
     - 2-column grid (lg) with AccuracyChart and ConfidenceChart
     - CategoryBreakdown full width below
   - Extract data from hooks, handle undefined/null with defaults

2. Create frontend/src/app/dashboard/page.tsx:
   - Import DashboardContent from @/components/dashboard/dashboard-content
   - Export default function DashboardPage that renders DashboardContent
   - Add metadata export with title "Analytics - TOITURELV Cortex"
   - Wrap in container div with padding and max-width
  </action>
  <verify>
    Run `cd frontend && pnpm tsc --noEmit` - should pass.
    Run `cd frontend && pnpm build` - should succeed.
    Run `cd frontend && pnpm dev` in background, visit http://localhost:3000/dashboard - page should render (may show loading/empty states without Supabase data).
  </verify>
  <done>
    Dashboard page accessible at /dashboard, shows time filter, stats cards, and all three chart sections. Loading and empty states work correctly.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete analytics dashboard with accuracy chart, confidence correlation, category breakdown, stats cards, and time filtering</what-built>
  <how-to-verify>
    1. Start the frontend: `cd frontend && pnpm dev`
    2. Visit http://localhost:3000/dashboard
    3. Verify you see:
       - Page title "Analytics Dashboard"
       - Time filter with "7 Days", "30 Days", "All Time" buttons
       - 4 stats cards (Total Estimates, Reviewed, Within 10%, Within 20%)
       - Accuracy chart section (may show "No reviewed estimates yet" empty state)
       - Confidence chart section
       - Category breakdown section
    4. Click time filter buttons - they should toggle (active state visible)
    5. Check responsive layout: on mobile (resize browser), cards should stack

    Note: Charts will show empty/loading states until Phase 5 is complete and Supabase has data.
    This is expected - we're verifying the UI structure, not data.
  </how-to-verify>
  <resume-signal>Type "approved" if dashboard renders correctly, or describe any visual/layout issues</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:
1. `cd frontend && pnpm build` succeeds without errors
2. /dashboard route exists and renders
3. All 6 component files exist in frontend/src/components/dashboard/
4. Time filter toggles between periods (UI state changes)
5. Charts use shadcn/ui ChartContainer with proper min-height
6. Empty states display friendly messages, not crashes
</verification>

<success_criteria>
- DASH-01: Accuracy chart shows % within 10%/20% thresholds (or empty state)
- DASH-02: Confidence chart shows accuracy by confidence level (or empty state)
- DASH-03: Category breakdown shows pie chart distribution (or empty state)
- DASH-04: Stats cards show totals, time filter works
- All components handle loading and empty data gracefully
- Dashboard is responsive (works on mobile viewport)
- Visual design matches shadcn/ui patterns
</success_criteria>

<output>
After completion, create `.planning/phases/06-analytics-dashboard/06-02-SUMMARY.md`
</output>
