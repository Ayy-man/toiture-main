---
phase: 27-ai-chat-interface
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/chat/chat-container.tsx
  - frontend/src/components/chat/chat-message.tsx
  - frontend/src/components/chat/chat-input.tsx
  - frontend/src/components/chat/suggestion-pills.tsx
  - frontend/src/components/chat/chat-typing-indicator.tsx
  - frontend/src/app/(admin)/chat/page.tsx
  - frontend/src/components/admin/app-sidebar.tsx
  - frontend/src/lib/i18n/fr.ts
  - frontend/src/lib/i18n/en.ts
autonomous: true

must_haves:
  truths:
    - "Chat page renders at /chat with mobile-first full-height layout"
    - "User can type messages in auto-resizing textarea and send via button or Enter"
    - "Messages display as user/assistant bubbles with distinct styling"
    - "Chat auto-scrolls to latest message when new messages arrive"
    - "Suggestion pills render as horizontal scrollable chips below the message area"
    - "Typing indicator shows while waiting for assistant response"
    - "Chat navigation item appears in sidebar"
  artifacts:
    - path: "frontend/src/components/chat/chat-container.tsx"
      provides: "Full-height chat layout with fixed header, scrollable messages, fixed bottom input"
      contains: "ChatContainer"
    - path: "frontend/src/components/chat/chat-message.tsx"
      provides: "User and assistant message bubbles with avatar and timestamp"
      contains: "ChatMessage"
    - path: "frontend/src/components/chat/chat-input.tsx"
      provides: "Auto-resizing textarea with send button"
      contains: "ChatInput"
    - path: "frontend/src/components/chat/suggestion-pills.tsx"
      provides: "Horizontal scrollable quick-reply chips"
      contains: "SuggestionPills"
    - path: "frontend/src/app/(admin)/chat/page.tsx"
      provides: "Chat page route rendering ChatContainer"
      contains: "ChatPage"
  key_links:
    - from: "frontend/src/app/(admin)/chat/page.tsx"
      to: "frontend/src/components/chat/chat-container.tsx"
      via: "import and render ChatContainer"
      pattern: "ChatContainer"
    - from: "frontend/src/components/admin/app-sidebar.tsx"
      to: "/chat"
      via: "nav item with href=/chat"
      pattern: "href.*chat"
---

<objective>
Build all frontend chat UI components and the /chat route page. This creates the visual chat interface — message bubbles, auto-resizing input, suggestion pills, typing indicator, and the page layout — all wired with local state management. No API integration yet (that's Plan 03).

Purpose: Create the complete UI shell for the conversational interface that Steven will use on his phone. Components use local state and mock data so they can be developed and tested independently of the backend.

Output: Working /chat page with all chat components rendering, accepting input, displaying messages, and showing suggestions. Uses local state only — API wiring happens in Plan 03.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-ai-chat-interface/DESIGN.md
@.planning/phases/27-ai-chat-interface/27-RESEARCH.md
@frontend/src/app/(admin)/layout.tsx
@frontend/src/components/admin/app-sidebar.tsx
@frontend/src/components/ui/button.tsx
@frontend/src/components/ui/textarea.tsx
@frontend/src/components/ui/badge.tsx
@frontend/src/components/ui/card.tsx
@frontend/src/lib/i18n/fr.ts
@frontend/src/lib/i18n/en.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Chat UI components (ChatMessage, ChatInput, SuggestionPills, TypingIndicator)</name>
  <files>
    frontend/src/components/chat/chat-message.tsx
    frontend/src/components/chat/chat-input.tsx
    frontend/src/components/chat/suggestion-pills.tsx
    frontend/src/components/chat/chat-typing-indicator.tsx
  </files>
  <action>
Create 4 component files in `frontend/src/components/chat/`:

**1. chat-message.tsx** — Message bubble component:
```
"use client";
```
- Props: `role: "user" | "assistant"`, `content: string`, `timestamp?: string`
- User messages: right-aligned, primary background (bg-primary text-primary-foreground), rounded-2xl with rounded-br-md
- Assistant messages: left-aligned, muted background (bg-muted), rounded-2xl with rounded-bl-md
- Assistant messages have a small Bot icon (from lucide-react `Bot`) as avatar on the left, user messages have a `User` icon on the right
- Content supports basic markdown: bold (**text**) and line breaks
- Timestamp shown below message in text-xs text-muted-foreground format (e.g., "14:32")
- Use cn() utility from `@/lib/utils` for conditional classes
- Mobile-first: max-width of 85% of container width on mobile, 70% on desktop (max-w-[85%] md:max-w-[70%])

**2. chat-input.tsx** — Auto-resizing input with send button:
```
"use client";
```
- Props: `onSend: (message: string) => void`, `disabled?: boolean`, `placeholder?: string`
- Uses a `<textarea>` (NOT the shadcn Textarea component — need direct ref control for auto-resize)
- Auto-resize behavior: starts at 1 row, grows up to 4 rows (max-h-32), then scrolls
- Auto-resize via useEffect + useRef: on input change, set height to "auto" then to scrollHeight
- Send button: uses shadcn Button with `Send` icon from lucide-react, primary variant, positioned to the right of textarea
- Send triggers on: button click OR Enter key (without Shift). Shift+Enter creates newline.
- After send: clear input, reset height to 1 row
- Disabled state: greys out textarea and button, shows loading spinner in button
- Layout: flex row with textarea taking flex-1 and send button at end
- Wrapper has border rounded-xl with padding, similar to modern chat apps
- Mobile keyboard handling: add `enterkeyhint="send"` attribute to textarea for mobile keyboards

**3. suggestion-pills.tsx** — Quick-reply suggestion chips:
```
"use client";
```
- Props: `suggestions: string[]`, `onSelect: (suggestion: string) => void`, `disabled?: boolean`
- Renders as horizontal scrollable flex row (overflow-x-auto, flex-nowrap, gap-2)
- Each pill: shadcn Badge variant="outline" with cursor-pointer, hover effect (hover:bg-primary hover:text-primary-foreground transition-colors), rounded-full, px-3 py-1.5
- Hide scrollbar but keep scroll functionality: `scrollbar-hide` or `[&::-webkit-scrollbar]:hidden` CSS
- If suggestions is empty, render nothing (return null)
- Animate in: pills have a slight fade-in when they change (opacity transition)

**4. chat-typing-indicator.tsx** — Three-dot typing animation:
```
"use client";
```
- Props: `visible: boolean`
- Three bouncing dots animation in a muted bubble (same style as assistant message)
- CSS-only animation: three `<span>` dots with staggered animation-delay (0s, 0.15s, 0.3s)
- Uses `@keyframes bounce` or Tailwind animate-bounce with delays
- When visible=false, render nothing
- Small Bot icon avatar on left (same as assistant messages for consistency)
  </action>
  <verify>
    Verify all 4 files exist: `ls frontend/src/components/chat/chat-message.tsx frontend/src/components/chat/chat-input.tsx frontend/src/components/chat/suggestion-pills.tsx frontend/src/components/chat/chat-typing-indicator.tsx`
    Check imports compile: `cd frontend && npx tsc --noEmit --pretty 2>&1 | head -20` (should show no errors in chat components, or only unrelated warnings)
  </verify>
  <done>
    Four chat UI components exist with proper TypeScript types. ChatMessage renders user/assistant bubbles with avatars. ChatInput has auto-resizing textarea with send on Enter. SuggestionPills renders horizontal scrollable chips. TypingIndicator shows animated dots.
  </done>
</task>

<task type="auto">
  <name>Task 2: ChatContainer, /chat page route, sidebar nav, and i18n keys</name>
  <files>
    frontend/src/components/chat/chat-container.tsx
    frontend/src/app/(admin)/chat/page.tsx
    frontend/src/components/admin/app-sidebar.tsx
    frontend/src/lib/i18n/fr.ts
    frontend/src/lib/i18n/en.ts
  </files>
  <action>
**1. frontend/src/components/chat/chat-container.tsx** — Main chat layout component:
```
"use client";
```
- This is the primary container that composes all chat components together
- Uses local state only (no API calls — those come in Plan 03):
  - `messages: Array<{id: string, role: "user"|"assistant", content: string, timestamp: string}>`
  - `suggestions: string[]` — initialized with greeting suggestions
  - `isLoading: boolean` — shows typing indicator
  - `sessionState: string` — tracks conversation state

- Layout structure (mobile-first, full viewport height minus header):
  ```
  <div className="flex flex-col h-[calc(100vh-4rem)]">  // Full height minus admin header
    <ChatHeader />     // Fixed top: title + "New Chat" button
    <MessageList />    // Scrollable middle area (flex-1 overflow-y-auto)
    <SuggestionPills /> // Above input, only when suggestions exist
    <ChatInput />      // Fixed bottom
  </div>
  ```

- ChatHeader: Simple div with "Cortex Chat" title (from i18n), a "New Chat" button (RotateCcw icon) that resets messages/state, and a small badge showing session state
- MessageList: Maps over messages array, renders ChatMessage for each. Uses a `messagesEndRef` (useRef + scrollIntoView) for auto-scroll to bottom when messages change. Shows TypingIndicator at bottom when isLoading.
- Auto-scroll: useEffect that scrolls messagesEndRef.current?.scrollIntoView({behavior: "smooth"}) whenever messages array length changes

- Local mock behavior (will be replaced by API in Plan 03):
  - handleSend: adds user message to messages, sets isLoading=true, after 1s timeout adds a mock assistant reply like "I understood: [message]. (API integration pending)" and sets isLoading=false
  - handleSuggestionSelect: calls handleSend with the suggestion text
  - Initial greeting message in messages array (bilingual via useLanguage hook): "Bonjour! Decrivez le projet de toiture et je preparerai le devis."

- Export the component and also export the Message type for reuse in Plan 03

**2. frontend/src/app/(admin)/chat/page.tsx** — Chat page route:
- Simple "use client" page that renders `<ChatContainer />`
- Include page metadata if needed (but admin layout handles breadcrumbs)

**3. frontend/src/components/admin/app-sidebar.tsx** — Add chat nav item:
- Add to the `useNavItems()` array: `{ title: t.nav.chat, href: "/chat", icon: MessageCircle }` (use `MessageCircle` from lucide-react, different from `MessageSquare` used by retours)
- Place it as the SECOND item in the nav list (after Estimateur, before Historique) — Steven uses chat frequently from mobile, needs it prominent
- Import MessageCircle from lucide-react

**4. frontend/src/lib/i18n/fr.ts** — Add French chat translations:
Add a new `chat` section to the translations object:
```typescript
chat: {
  title: "Chat Cortex",
  newChat: "Nouveau chat",
  placeholder: "Decrivez le projet de toiture...",
  greeting: "Bonjour! Decrivez le projet de toiture et je preparerai le devis. Par exemple: '1200 pi2, bardeaux, pente raide, acces difficile'",
  generateQuote: "Generer le devis",
  readyToGenerate: "Pret a generer le devis?",
  generating: "Generation du devis en cours...",
  quoteGenerated: "Devis genere!",
  selectTier: "Selectionnez un niveau",
  createSubmission: "Creer la soumission",
  submissionCreated: "Soumission creee!",
  extractedFields: "Champs extraits",
  sessionState: "Etat de la session",
  sendMessage: "Envoyer",
  voiceInput: "Entree vocale",
  listening: "Ecoute en cours...",
},
```
Also add to nav section: `chat: "Chat",`

**5. frontend/src/lib/i18n/en.ts** — Add English chat translations:
Mirror the French structure with English values:
```typescript
chat: {
  title: "Cortex Chat",
  newChat: "New chat",
  placeholder: "Describe the roofing project...",
  greeting: "Hi! Describe the roofing job and I'll build the quote. For example: '1200 sqft, shingles, steep pitch, difficult access'",
  generateQuote: "Generate quote",
  readyToGenerate: "Ready to generate the quote?",
  generating: "Generating quote...",
  quoteGenerated: "Quote generated!",
  selectTier: "Select a tier",
  createSubmission: "Create submission",
  submissionCreated: "Submission created!",
  extractedFields: "Extracted fields",
  sessionState: "Session state",
  sendMessage: "Send",
  voiceInput: "Voice input",
  listening: "Listening...",
},
```
Also add to nav section: `chat: "Chat",`

**Update admin layout.tsx routeLabels** — Add `chat: t.nav.chat` to the routeLabels object in `frontend/src/app/(admin)/layout.tsx`.
  </action>
  <verify>
    Run: `cd frontend && npx tsc --noEmit --pretty 2>&1 | head -30` — Should compile without type errors in the new chat files.
    Verify route exists: `ls frontend/src/app/\(admin\)/chat/page.tsx` — File should exist.
    Verify i18n: `grep -c "chat:" frontend/src/lib/i18n/fr.ts frontend/src/lib/i18n/en.ts` — Both files should contain chat section.
  </verify>
  <done>
    ChatContainer renders full-height chat layout with all sub-components composed. /chat page route is accessible. Sidebar has "Chat" nav item with MessageCircle icon as second item. i18n keys added for FR/EN. Admin layout breadcrumbs support /chat route. Local mock behavior allows testing UI without backend.
  </done>
</task>

</tasks>

<verification>
1. Navigate to /chat in the browser — page renders with chat interface
2. Chat sidebar item visible with MessageCircle icon
3. Greeting message appears on load
4. Can type message and press Enter to send — user bubble appears
5. Mock assistant reply appears after 1 second with typing indicator
6. Suggestion pills render and are clickable (clicking sends as message)
7. Auto-scroll works when messages overflow viewport
8. Input auto-resizes when typing multi-line messages
9. "New Chat" button resets the conversation
10. Language toggle switches greeting and placeholder text
</verification>

<success_criteria>
- All chat UI components render correctly on mobile viewport (375px width)
- Chat layout uses full available height with fixed header and input
- Messages display as distinct user/assistant bubbles
- Input handles Enter to send and Shift+Enter for newlines
- Suggestion pills are horizontally scrollable
- i18n keys present in both FR and EN translation files
</success_criteria>

<output>
After completion, create `.planning/phases/27-ai-chat-interface/27-02-SUMMARY.md`
</output>
