---
phase: 25-ui-polish-dark-mode
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/lib/i18n/fr.ts
  - frontend/src/lib/i18n/en.ts
  - frontend/src/components/estimateur/full-quote-form.tsx
  - frontend/src/lib/pdf/quote-template.tsx
autonomous: true

must_haves:
  truths:
    - "Tier descriptions in full-quote-form use translation keys (t.*) not inline ternaries"
    - "Factor checklist labels use translation keys not inline ternaries"
    - "Equipment option labels use translation keys not inline ternaries"
    - "PDF template labels switch between FR and EN based on locale"
    - "Switching language mid-session updates all tier names, descriptions, and factor labels"
  artifacts:
    - path: "frontend/src/lib/i18n/fr.ts"
      provides: "French tier descriptions, factor labels, equipment names, PDF labels"
      contains: "tiers"
    - path: "frontend/src/lib/i18n/en.ts"
      provides: "English tier descriptions, factor labels, equipment names, PDF labels"
      contains: "tiers"
    - path: "frontend/src/lib/pdf/quote-template.tsx"
      provides: "Bilingual PDF template"
      contains: "locale"
  key_links:
    - from: "frontend/src/components/estimateur/full-quote-form.tsx"
      to: "frontend/src/lib/i18n/fr.ts"
      via: "useLanguage hook t.complexity.tiers"
      pattern: "t\\.complexity"
    - from: "frontend/src/lib/pdf/quote-template.tsx"
      to: "frontend/src/lib/i18n"
      via: "locale parameter for bilingual labels"
      pattern: "locale"
---

<objective>
Move hardcoded inline tier descriptions, factor labels, and equipment options from full-quote-form.tsx into translation files, and make the PDF template bilingual.

Purpose: Fix FR/EN inconsistency where tier descriptions, complexity factor labels, and equipment names use `locale === 'fr' ? "..." : "..."` inline ternaries instead of the established i18n translation system. Also fix the PDF template which has hardcoded French labels.

Output: All form text uses `t.*` translation keys. PDF template accepts locale and renders in correct language.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@frontend/src/lib/i18n/fr.ts
@frontend/src/lib/i18n/en.ts
@frontend/src/components/estimateur/full-quote-form.tsx
@frontend/src/lib/pdf/quote-template.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tier, factor, equipment, and PDF translation keys to i18n files</name>
  <files>
    frontend/src/lib/i18n/fr.ts
    frontend/src/lib/i18n/en.ts
  </files>
  <action>
Add a new `complexity` section and `pdf` section to BOTH fr.ts and en.ts translation files. These keys replace the inline ternaries currently in full-quote-form.tsx (lines 54-171) and the hardcoded French in quote-template.tsx.

Add the following sections to `fr.ts` (inside the main export object, after the existing sections):

```typescript
complexity: {
  tiers: {
    tier1: {
      name: "Simple / Standard",
      description: "Maison plain-pied, toit plat a faible pente (0-4/12), acces facile par entree, pas de grue, 1-2 sections, materiaux standards",
    },
    tier2: {
      name: "Modere",
      description: "Maison 2 etages, pente 4/12 a 6/12, bon acces rue, quelques penetrations, 2-3 sections, arrachage standard",
    },
    tier3: {
      name: "Complexe",
      description: "2 etages avec forte pente (6/12-8/12), acces limite, penetrations multiples, 3-4 sections, arrachage multi-couches",
    },
    tier4: {
      name: "Haute complexite",
      description: "3 etages ou pente 8/12+, acces difficile (grue recommandee), penetrations nombreuses, 4+ sections, equipement securite requis",
    },
    tier5: {
      name: "Tres haute complexite",
      description: "3 etages, pente 10/12+, grue requise, acces extreme (centre-ville), penetrations etendues, 5+ sections, couches multiples",
    },
    tier6: {
      name: "Extreme",
      description: "Commercial/haute elevation, pente extreme, grue obligatoire, acces dangereux (echafaudage + harnais), travaux structuraux, conditions hivernales",
    },
  },
  factors: {
    roofPitch: {
      label: "Pente du toit",
      flat: "Plat (0-2/12)",
      low: "Faible (3/12-4/12)",
      medium: "Moyen (5/12-6/12)",
      steep: "Forte (7/12-8/12)",
      verySteep: "Tres forte (9/12+)",
    },
    accessDifficulty: {
      label: "Difficulte d'acces",
      noCrane: "Pas d'acces pour grue",
      narrowDriveway: "Entree etroite",
      streetBlocking: "Blocage de rue requis",
      highElevation: "Haute elevation (3+ etages)",
      difficultTerrain: "Terrain difficile",
      noMaterialDrop: "Pas de zone de depot",
    },
    demolition: {
      label: "Demolition",
      none: "Aucun",
      singleLayer: "Une couche",
      multiLayer: "Multi-couches",
      structural: "Structural",
    },
    penetrations: {
      label: "Nombre de penetrations (events, tuyaux, puits de lumiere)",
    },
    security: {
      label: "Securite",
      harness: "Harnais de securite",
      scaffolding: "Echafaudage",
      guardrails: "Garde-corps",
      winterSafety: "Securite hivernale",
    },
    materialRemoval: {
      label: "Retrait de materiaux",
      none: "Aucun",
      standard: "Standard",
      heavy: "Lourd",
      hazardous: "Dangereux (amiante)",
    },
    roofSections: {
      label: "Nombre de sections de toit",
    },
    previousLayers: {
      label: "Nombre de couches precedentes",
    },
  },
  equipment: {
    crane: "Grue",
    scaffolding: "Echafaudage",
    dumpster: "Conteneur a dechets",
    generator: "Generatrice",
    compressor: "Compresseur",
  },
},
pdf: {
  title: "SOUMISSION",
  company: "Toiture LV",
  dateLabel: "Date:",
  categoryLabel: "Categorie:",
  areaLabel: "Superficie:",
  areaUnit: "pi2",
  workItemsTitle: "Travaux",
  summaryTitle: "Sommaire",
  materials: "Materiaux",
  labor: "Main-d'oeuvre",
  total: "TOTAL",
  footer: "Cette soumission est valide pour 30 jours a compter de la date d'emission.",
},
```

Add the EQUIVALENT English translations to `en.ts`:

```typescript
complexity: {
  tiers: {
    tier1: {
      name: "Simple / Standard",
      description: "Single-story home, flat or low-slope roof (0-4/12), easy entry access, no crane, 1-2 sections, standard materials",
    },
    tier2: {
      name: "Moderate",
      description: "2-story home, pitch 4/12 to 6/12, good street access, some penetrations, 2-3 sections, standard tear-off",
    },
    tier3: {
      name: "Complex",
      description: "2-story with steep pitch (6/12-8/12), limited access, multiple penetrations, 3-4 sections, multi-layer tear-off",
    },
    tier4: {
      name: "High Complexity",
      description: "3-story or pitch 8/12+, difficult access (crane recommended), numerous penetrations, 4+ sections, safety equipment required",
    },
    tier5: {
      name: "Very High Complexity",
      description: "3-story, pitch 10/12+, crane required, extreme access (downtown), extensive penetrations, 5+ sections, multiple layers",
    },
    tier6: {
      name: "Extreme",
      description: "Commercial/high elevation, extreme pitch, crane mandatory, dangerous access (scaffolding + harness), structural work, winter conditions",
    },
  },
  factors: {
    roofPitch: {
      label: "Roof Pitch",
      flat: "Flat (0-2/12)",
      low: "Low (3/12-4/12)",
      medium: "Medium (5/12-6/12)",
      steep: "Steep (7/12-8/12)",
      verySteep: "Very Steep (9/12+)",
    },
    accessDifficulty: {
      label: "Access Difficulty",
      noCrane: "No crane access",
      narrowDriveway: "Narrow driveway",
      streetBlocking: "Street blocking required",
      highElevation: "High elevation (3+ stories)",
      difficultTerrain: "Difficult terrain",
      noMaterialDrop: "No material drop zone",
    },
    demolition: {
      label: "Demolition",
      none: "None",
      singleLayer: "Single layer",
      multiLayer: "Multi-layer",
      structural: "Structural",
    },
    penetrations: {
      label: "Number of penetrations (vents, pipes, skylights)",
    },
    security: {
      label: "Security",
      harness: "Safety harness",
      scaffolding: "Scaffolding",
      guardrails: "Guardrails",
      winterSafety: "Winter safety",
    },
    materialRemoval: {
      label: "Material Removal",
      none: "None",
      standard: "Standard",
      heavy: "Heavy",
      hazardous: "Hazardous (asbestos)",
    },
    roofSections: {
      label: "Number of roof sections",
    },
    previousLayers: {
      label: "Number of previous layers",
    },
  },
  equipment: {
    crane: "Crane",
    scaffolding: "Scaffolding",
    dumpster: "Dumpster",
    generator: "Generator",
    compressor: "Compressor",
  },
},
pdf: {
  title: "QUOTE",
  company: "Toiture LV",
  dateLabel: "Date:",
  categoryLabel: "Category:",
  areaLabel: "Area:",
  areaUnit: "sq ft",
  workItemsTitle: "Work Items",
  summaryTitle: "Summary",
  materials: "Materials",
  labor: "Labor",
  total: "TOTAL",
  footer: "This quote is valid for 30 days from the date of issue.",
},
```

IMPORTANT: Both files currently have 369 lines. Add the new sections BEFORE the closing `}` of the main export object. Ensure the TypeScript type structure matches between fr.ts and en.ts exactly (same keys, same nesting). Preserve ALL existing translation keys — do not modify or remove anything.
  </action>
  <verify>
    Run `cd frontend && npx tsc --noEmit` — TypeScript compiles without errors. Both files should have matching structure (same keys in fr.ts and en.ts).
  </verify>
  <done>
    Both fr.ts and en.ts contain complexity.tiers (6 tiers with name+description), complexity.factors (8 factor groups with all option labels), complexity.equipment (5 items), and pdf (all template labels). All keys match between files.
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor full-quote-form.tsx to use translation keys and make PDF bilingual</name>
  <files>
    frontend/src/components/estimateur/full-quote-form.tsx
    frontend/src/lib/pdf/quote-template.tsx
  </files>
  <action>
1. **Refactor full-quote-form.tsx** — Replace ALL inline `locale === 'fr' ? "..." : "..."` ternaries with `t.*` translation keys.

   The component already imports `useLanguage` and has `const { locale, t } = useLanguage();` (or similar). Use the `t` object to reference the new keys.

   **Tier descriptions (lines ~54-110):** Replace the tierOptions array to use:
   ```tsx
   const tierOptions = [
     { tier: 1, name: t.complexity.tiers.tier1.name, description: t.complexity.tiers.tier1.description, score_range: [0, 17] },
     { tier: 2, name: t.complexity.tiers.tier2.name, description: t.complexity.tiers.tier2.description, score_range: [18, 33] },
     // ... etc for all 6 tiers
   ];
   ```

   **Factor options (lines ~112-171):** Replace each factor's options array labels. For example, roofPitch:
   ```tsx
   options: [
     { key: "flat", hours: 0, label: t.complexity.factors.roofPitch.flat },
     { key: "low", hours: 1, label: t.complexity.factors.roofPitch.low },
     { key: "medium", hours: 2, label: t.complexity.factors.roofPitch.medium },
     { key: "steep", hours: 4, label: t.complexity.factors.roofPitch.steep },
     { key: "very_steep", hours: 8, label: t.complexity.factors.roofPitch.verySteep },
   ],
   ```

   Do the same for ALL factor groups:
   - `accessDifficulty` — 6 options
   - `demolition` — 4 options
   - `penetrations` — label only (uses `hours_per_item` pattern)
   - `security` — 4 options
   - `materialRemoval` — 4 options
   - `roofSections` — label only (uses `baseline` pattern)
   - `previousLayers` — label only (uses `baseline` pattern)

   **Equipment options (lines ~190-196):** Replace:
   ```tsx
   const equipmentOptions = [
     { id: "crane", label: t.complexity.equipment.crane, dailyCost: 25 },
     { id: "scaffolding", label: t.complexity.equipment.scaffolding, dailyCost: 25 },
     { id: "dumpster", label: t.complexity.equipment.dumpster, dailyCost: 25 },
     { id: "generator", label: t.complexity.equipment.generator, dailyCost: 25 },
     { id: "compressor", label: t.complexity.equipment.compressor, dailyCost: 25 },
   ];
   ```

   CRITICAL: Do NOT change any business logic (hours, tier numbers, score ranges, daily costs). Only change the text labels to use `t.*` references. The `locale` variable can still exist in scope but should no longer be used for inline ternaries in this file — the sidebar locale toggle (app-sidebar.tsx) is the only place that legitimately uses `locale` comparisons.

2. **Make PDF template bilingual** — Update `frontend/src/lib/pdf/quote-template.tsx`:

   - Add a `locale` prop to `QuotePDFDocumentProps`:
     ```tsx
     interface QuotePDFDocumentProps {
       quote: HybridQuoteResponse;
       category: string;
       sqft: number;
       date: string;
       locale?: string; // "fr" | "en", defaults to "fr"
     }
     ```

   - Import both translation objects directly (since @react-pdf/renderer cannot use React hooks):
     ```tsx
     import { fr } from "@/lib/i18n/fr";
     import { en } from "@/lib/i18n/en";
     ```

   - Inside the component, select the translation set:
     ```tsx
     const t = locale === "en" ? en : fr;
     ```

   - Replace ALL hardcoded French strings with `t.pdf.*`:
     - Line 132: `"SOUMISSION"` → `{t.pdf.title}`
     - Line 133: `"Toiture LV"` → `{t.pdf.company}`
     - Line 139: `"Date:"` → `{t.pdf.dateLabel}`
     - Line 143: `"Categorie:"` → `{t.pdf.categoryLabel}`
     - Line 147: `"Superficie:"` → `{t.pdf.areaLabel}`
     - Line 149: `pi2` → `{t.pdf.areaUnit}`
     - Line 156: `"Travaux"` → `{t.pdf.workItemsTitle}`
     - Line 167: `"Sommaire"` → `{t.pdf.summaryTitle}`
     - Line 169: `"Materiaux"` → `{t.pdf.materials}`
     - Line 173: `"Main-d'oeuvre"` → `{t.pdf.labor}`
     - Line 177: `"TOTAL"` → `{t.pdf.total}`
     - Line 186-187: The footer text → `{t.pdf.footer}`

   - Also update the `formatCAD` function to use locale-aware formatting:
     ```tsx
     function formatCAD(amount: number, locale: string = "fr"): string {
       return new Intl.NumberFormat(locale === "en" ? "en-CA" : "fr-CA", {
         style: "currency",
         currency: "CAD",
         minimumFractionDigits: 0,
         maximumFractionDigits: 0,
       }).format(amount);
     }
     ```
     Pass `locale` to formatCAD calls inside the component.

   - Find where `QuotePDFDocument` is rendered (likely in `quote-actions.tsx`) and pass `locale` from the useLanguage hook:
     ```tsx
     const { locale } = useLanguage();
     // ...
     <QuotePDFDocument quote={quote} category={category} sqft={sqft} date={date} locale={locale} />
     ```
  </action>
  <verify>
    Run `cd frontend && pnpm build` — build succeeds. Verify no `locale === 'fr'` ternaries remain in full-quote-form.tsx (grep for the pattern). Verify quote-template.tsx has no hardcoded French strings like "SOUMISSION", "Materiaux", "Travaux".
  </verify>
  <done>
    Zero inline locale ternaries in full-quote-form.tsx — all text uses t.* translation keys. PDF template renders all labels from translation files based on locale prop. Currency formatting uses locale-aware Intl.NumberFormat. Switching language mid-session updates all tier names, descriptions, factor labels, and equipment names immediately.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && pnpm build` completes without errors
2. `grep -c "locale === 'fr'" frontend/src/components/estimateur/full-quote-form.tsx` returns 0
3. `grep -c "SOUMISSION" frontend/src/lib/pdf/quote-template.tsx` returns 0 (now uses t.pdf.title)
4. Switch language toggle EN → FR → EN while viewing full quote form — all tier names, descriptions, factor labels, and equipment names update immediately
5. PDF export renders labels in the currently selected language
</verification>

<success_criteria>
- All tier descriptions use t.complexity.tiers.* translation keys
- All factor labels use t.complexity.factors.* translation keys
- All equipment names use t.complexity.equipment.* translation keys
- PDF template renders bilingual labels based on locale prop
- No hardcoded French or English strings in modified files (outside i18n/)
- Language switch updates all text immediately without page refresh
</success_criteria>

<output>
After completion, create `.planning/phases/25-ui-polish-dark-mode/25-02-SUMMARY.md`
</output>
