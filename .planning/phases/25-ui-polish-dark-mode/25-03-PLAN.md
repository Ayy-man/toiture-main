---
phase: 25-ui-polish-dark-mode
plan: 03
type: execute
wave: 2
depends_on: ["25-01"]
files_modified:
  - frontend/src/components/apercu/revenue-chart.tsx
  - frontend/src/components/apercu/trend-chart.tsx
  - frontend/src/components/apercu/category-chart.tsx
  - frontend/src/components/apercu/metrics-cards.tsx
autonomous: false

must_haves:
  truths:
    - "Dashboard charts are readable in dark mode (axis labels, tooltips, legends)"
    - "LV brick red accent color visible in buttons, sidebar, focus rings in both light and dark mode"
    - "Chart tooltip backgrounds use semantic CSS variables not hardcoded hex"
    - "Metrics cards maintain contrast in dark mode"
  artifacts:
    - path: "frontend/src/components/apercu/revenue-chart.tsx"
      provides: "Dark-mode-compatible chart with semantic colors"
      contains: "var(--"
    - path: "frontend/src/components/apercu/trend-chart.tsx"
      provides: "Dark-mode-compatible trend chart"
      contains: "var(--"
  key_links:
    - from: "frontend/src/components/apercu/revenue-chart.tsx"
      to: "frontend/src/app/globals.css"
      via: "CSS variables for chart colors"
      pattern: "hsl\\(var\\(--"
    - from: "frontend/src/components/apercu/trend-chart.tsx"
      to: "frontend/src/app/globals.css"
      via: "CSS variables for chart axis/tooltip colors"
      pattern: "hsl\\(var\\(--"
---

<objective>
Audit and fix Recharts dashboard charts for dark mode compatibility, then visually verify LV branding across both themes.

Purpose: Ensure the Apercu dashboard charts (revenue, trend, category) render correctly in dark mode — axis labels readable, tooltips with proper backgrounds, legend text visible. Also verify LV brick red accent appears consistently in buttons, sidebar, and focus rings across both light and dark themes.

Output: Charts work in both modes. Branding verified. Visual confirmation checkpoint.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/25-ui-polish-dark-mode/25-01-SUMMARY.md
@frontend/src/app/globals.css
@frontend/src/components/apercu/revenue-chart.tsx
@frontend/src/components/apercu/trend-chart.tsx
@frontend/src/components/apercu/category-chart.tsx
@frontend/src/components/apercu/metrics-cards.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Recharts components for dark mode compatibility</name>
  <files>
    frontend/src/components/apercu/revenue-chart.tsx
    frontend/src/components/apercu/trend-chart.tsx
    frontend/src/components/apercu/category-chart.tsx
    frontend/src/components/apercu/metrics-cards.tsx
  </files>
  <action>
Audit each chart component in `frontend/src/components/apercu/` for hardcoded colors that will be invisible or low-contrast in dark mode. Recharts does NOT automatically inherit CSS variables — axis labels, tick marks, grid lines, and tooltip backgrounds often use hardcoded hex values.

**For EACH chart component (revenue-chart.tsx, trend-chart.tsx, category-chart.tsx):**

1. **Axis labels and ticks** — Look for `<XAxis>` and `<YAxis>` components. If they have `stroke` or `tick` props with hardcoded colors (like `"#666"`, `"#333"`, `"#888"`), replace with CSS variable references:
   ```tsx
   <XAxis
     stroke="hsl(var(--muted-foreground))"
     tick={{ fill: "hsl(var(--muted-foreground))", fontSize: 12 }}
   />
   <YAxis
     stroke="hsl(var(--muted-foreground))"
     tick={{ fill: "hsl(var(--muted-foreground))", fontSize: 12 }}
   />
   ```
   If no stroke/tick props exist, ADD them (Recharts defaults to black which is invisible on dark backgrounds).

2. **Grid lines** — Look for `<CartesianGrid>`. If it uses hardcoded stroke colors, replace:
   ```tsx
   <CartesianGrid strokeDasharray="3 3" stroke="hsl(var(--border))" />
   ```

3. **Tooltip** — Look for `<Tooltip>` components. If they have `contentStyle` with hardcoded colors, replace:
   ```tsx
   <Tooltip
     contentStyle={{
       backgroundColor: "hsl(var(--popover))",
       borderColor: "hsl(var(--border))",
       color: "hsl(var(--popover-foreground))",
       borderRadius: "var(--radius)",
     }}
     labelStyle={{ color: "hsl(var(--popover-foreground))" }}
   />
   ```
   If no contentStyle exists, ADD it — default Recharts tooltip has a white background that is invisible in dark mode.

4. **Legend** — If `<Legend>` exists, ensure text color adapts:
   ```tsx
   <Legend
     wrapperStyle={{ color: "hsl(var(--foreground))" }}
   />
   ```

5. **Fill colors for bars/areas/pies** — These should already use `var(--chart-1)` through `var(--chart-5)` from the shadcn chart component. If any use hardcoded hex colors (like `"#8B2323"`), replace with `"hsl(var(--chart-1))"` etc.

**For metrics-cards.tsx:**
- Check if card backgrounds, text colors, and trend indicators use semantic Tailwind classes (`bg-card`, `text-card-foreground`, etc.)
- If any hardcoded colors exist (e.g., `text-gray-600`, `bg-white`), replace with semantic classes that respect dark mode:
  - `bg-white` → `bg-card`
  - `text-gray-600` → `text-muted-foreground`
  - `text-gray-900` → `text-card-foreground`
  - `border-gray-200` → `border-border`

**Pattern for CSS variable access in Recharts:**
Recharts accepts string values for style props. CSS variables work when accessed as `"hsl(var(--variable-name))"`. This works because the browser evaluates the CSS variable at render time. The variables are defined in globals.css and swap values when `.dark` class is applied.

IMPORTANT: Do NOT change the chart data, calculations, or layout structure. Only change color references to use semantic CSS variables.
  </action>
  <verify>
    Run `cd frontend && pnpm build` — build succeeds. Grep for hardcoded hex colors in chart files: `grep -E '#[0-9a-fA-F]{3,6}' frontend/src/components/apercu/*.tsx` should return minimal results (only brand colors that are intentional, not axis/tooltip colors).
  </verify>
  <done>
    All chart axis labels, ticks, grid lines, tooltips, and legends use semantic CSS variables (--muted-foreground, --border, --popover, etc.) that adapt to dark mode. Metrics cards use semantic Tailwind classes. No hardcoded colors for UI chrome elements.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of dark mode and LV branding</name>
  <files>None (visual verification only)</files>
  <action>
    Open the app in browser (localhost:3000 or production URL) and visually verify the following:

    1. **Dark mode toggle test:**
       - Find sun/moon button in top-right corner of admin header
       - Click to switch to dark mode — all backgrounds should darken, text should lighten
       - Click again to return to light mode — should restore original LV colors
       - Refresh page — theme should persist (check localStorage key "theme")

    2. **Language switch test:**
       - Switch to English using the EN/FR toggle in the sidebar footer
       - Navigate to Estimateur → Full Quote tab
       - Verify all tier names and descriptions show English text
       - Switch back to French — verify tier names switch to French

    3. **Dashboard charts test (in dark mode):**
       - Navigate to Apercu (dashboard)
       - Verify chart axis labels are readable (not black-on-dark)
       - Verify tooltips have dark backgrounds with light text
       - Verify LV brick red is visible as the primary chart color

    4. **Branding verification (both modes):**
       - Sidebar shows LV red accent on active nav item
       - Primary buttons show LV red background
       - Form focus rings show LV red outline
       - Dashboard charts use LV red as primary (chart-1) color

    5. **PDF export test (if accessible):**
       - Generate a quote and export PDF
       - Verify PDF labels match the selected language (FR or EN)
  </action>
  <verify>Human visual inspection confirms all items above look correct.</verify>
  <done>User types "approved" confirming dark mode, language switching, charts, and branding all work correctly.</done>
</task>

</tasks>

<verification>
1. `cd frontend && pnpm build` completes without errors
2. Charts render correctly in both light and dark mode
3. LV brick red accent visible consistently across both themes
4. Human confirms visual quality of dark mode, charts, and branding
</verification>

<success_criteria>
- Dashboard charts readable in dark mode (axis labels, tooltips, legends all visible)
- LV brick red (#8B2323 / hsl(10 72% 34%)) used as primary accent in both modes
- Dark mode variant (hsl(10 72% 50%)) provides sufficient contrast on dark backgrounds
- Human visual approval obtained for overall dark mode quality
</success_criteria>

<output>
After completion, create `.planning/phases/25-ui-polish-dark-mode/25-03-SUMMARY.md`
</output>
