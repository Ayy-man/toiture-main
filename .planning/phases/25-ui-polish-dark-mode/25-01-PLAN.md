---
phase: 25-ui-polish-dark-mode
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/src/app/layout.tsx
  - frontend/src/components/ui/theme-toggle.tsx
  - frontend/src/app/(admin)/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Sun/moon toggle button visible in top-right corner of admin header"
    - "Clicking toggle switches between light and dark mode"
    - "Theme preference persists after page refresh via localStorage"
    - "No hydration mismatch errors in browser console"
    - "All pages readable in both light and dark mode (CSS variables already defined)"
  artifacts:
    - path: "frontend/src/components/ui/theme-toggle.tsx"
      provides: "ThemeToggle component with Sun/Moon icons"
      min_lines: 20
    - path: "frontend/src/app/layout.tsx"
      provides: "ThemeProvider wrapping app"
      contains: "ThemeProvider"
  key_links:
    - from: "frontend/src/app/layout.tsx"
      to: "next-themes"
      via: "ThemeProvider with attribute='class'"
      pattern: "ThemeProvider.*attribute.*class"
    - from: "frontend/src/components/ui/theme-toggle.tsx"
      to: "next-themes"
      via: "useTheme hook"
      pattern: "useTheme"
    - from: "frontend/src/app/(admin)/layout.tsx"
      to: "frontend/src/components/ui/theme-toggle.tsx"
      via: "ThemeToggle in header"
      pattern: "ThemeToggle"
---

<objective>
Install next-themes and implement a dark mode toggle button in the admin header.

Purpose: Users can switch between light and dark mode with a sun/moon button. The dark mode CSS variables already exist in globals.css (lines 65-108) — this plan wires up the toggle mechanism using next-themes for SSR-safe theme switching.

Output: Working dark mode toggle in top-right corner, theme persists via localStorage.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/app/globals.css
@frontend/src/app/layout.tsx
@frontend/src/app/(admin)/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install next-themes and add ThemeProvider to root layout</name>
  <files>
    frontend/package.json
    frontend/src/app/layout.tsx
  </files>
  <action>
1. Install next-themes in frontend directory:
   ```bash
   cd frontend && pnpm add next-themes
   ```

2. Update `frontend/src/app/layout.tsx`:
   - Import `ThemeProvider` from `next-themes`
   - Add `suppressHydrationWarning` to the `<html>` tag (prevents Next.js warning about class mismatch during hydration)
   - Wrap `<QueryProvider>{children}</QueryProvider>` with `<ThemeProvider>`:
     ```tsx
     <ThemeProvider
       attribute="class"
       defaultTheme="system"
       enableSystem
       disableTransitionOnChange
     >
       <QueryProvider>{children}</QueryProvider>
     </ThemeProvider>
     ```
   - Key props explained:
     - `attribute="class"` — adds `dark` class to `<html>` element (matches Tailwind v4 `@custom-variant dark (&:is(.dark *))` on line 4 of globals.css)
     - `defaultTheme="system"` — respects OS preference initially
     - `enableSystem` — allows "System" option
     - `disableTransitionOnChange` — prevents jarring CSS transitions when switching themes

IMPORTANT: ThemeProvider must be INSIDE the `<body>` tag, wrapping the content. The `<html>` tag gets `suppressHydrationWarning` attribute only.
  </action>
  <verify>
    Run `cd frontend && pnpm build` — build succeeds with no errors. Check `pnpm list next-themes` shows installed version.
  </verify>
  <done>
    next-themes installed, ThemeProvider wraps app content in root layout, html tag has suppressHydrationWarning.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ThemeToggle component and wire into admin header</name>
  <files>
    frontend/src/components/ui/theme-toggle.tsx
    frontend/src/app/(admin)/layout.tsx
  </files>
  <action>
1. Create `frontend/src/components/ui/theme-toggle.tsx`:
   ```tsx
   "use client";

   import { Moon, Sun } from "lucide-react";
   import { useTheme } from "next-themes";
   import { Button } from "@/components/ui/button";
   import { useEffect, useState } from "react";

   export function ThemeToggle() {
     const { theme, setTheme } = useTheme();
     const [mounted, setMounted] = useState(false);

     // Prevent hydration mismatch — theme is undefined on server
     useEffect(() => {
       setMounted(true);
     }, []);

     if (!mounted) {
       // Return disabled placeholder to avoid layout shift
       return <Button variant="ghost" size="icon" className="size-9" disabled />;
     }

     return (
       <Button
         variant="ghost"
         size="icon"
         onClick={() => setTheme(theme === "dark" ? "light" : "dark")}
         className="size-9"
       >
         <Sun className="size-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
         <Moon className="absolute size-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
         <span className="sr-only">Toggle theme</span>
       </Button>
     );
   }
   ```

   Key implementation notes:
   - `mounted` state prevents hydration mismatch (theme is undefined on server, defined on client)
   - Sun/Moon icons swap with rotation animation using Tailwind dark: variants
   - `size-9` matches existing icon button sizing in the admin layout
   - Screen reader accessible with sr-only label
   - lucide-react is already installed (used throughout codebase)

2. Update `frontend/src/app/(admin)/layout.tsx`:
   - Import `ThemeToggle` from `@/components/ui/theme-toggle`
   - In the `<header>` element of `AdminLayoutInner`, add a `<div className="ml-auto">` wrapper containing `<ThemeToggle />` AFTER the `<Breadcrumb>` component:
     ```tsx
     <header className="flex h-16 shrink-0 items-center gap-2 border-b px-4">
       <SidebarTrigger className="-ml-1" />
       <Separator orientation="vertical" className="mr-2 h-4" />
       <Breadcrumb>
         {/* existing breadcrumb content unchanged */}
       </Breadcrumb>
       <div className="ml-auto">
         <ThemeToggle />
       </div>
     </header>
     ```
   - The `ml-auto` pushes the toggle to the far right of the header (top-right corner per requirement)
   - Do NOT modify anything else in this file — the LanguageProvider, breadcrumbs, and sidebar integration stay unchanged
  </action>
  <verify>
    Run `cd frontend && pnpm build` — build succeeds. Verify the ThemeToggle component file exists and exports the function. Check that layout.tsx imports and renders ThemeToggle in the header.
  </verify>
  <done>
    ThemeToggle component created with Sun/Moon animation. Toggle appears in top-right of admin header. Clicking toggles dark class on html element. Theme persists in localStorage via next-themes. No hydration mismatches.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && pnpm build` completes without errors
2. ThemeToggle renders in admin header top-right corner
3. Clicking toggle switches all page colors (CSS variables in globals.css lines 65-108 activate)
4. Refreshing browser preserves selected theme (next-themes stores in localStorage key "theme")
5. No hydration mismatch warnings in browser console
6. Sidebar dark theme still renders correctly (sidebar has its own CSS variables)
</verification>

<success_criteria>
- Sun/moon toggle button visible in top-right corner of admin header
- Toggle switches between light mode (current colors) and dark mode (globals.css .dark variables)
- Theme persists across page refresh
- No console errors or hydration mismatches
- All existing pages remain functional in both modes
</success_criteria>

<output>
After completion, create `.planning/phases/25-ui-polish-dark-mode/25-01-SUMMARY.md`
</output>
