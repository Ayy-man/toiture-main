---
phase: 14-full-quote-frontend
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - frontend/src/components/estimateur/quote-result.tsx
  - frontend/src/components/estimateur/full-quote-form.tsx
  - frontend/src/lib/i18n/fr.ts
autonomous: true

must_haves:
  truths:
    - "User can submit form and see invoice-style quote result"
    - "Work items display with labor hours (internal view)"
    - "Materials total and labor total display correctly"
    - "Confidence warning banner shows when < 50%"
    - "Reasoning section is collapsible"
    - "All labels are in French"
    - "Complexity presets component integrates with form state via Controller"
  artifacts:
    - path: "frontend/src/components/estimateur/quote-result.tsx"
      provides: "Invoice-style quote display component"
      exports: ["QuoteResult"]
    - path: "frontend/src/components/estimateur/full-quote-form.tsx"
      provides: "Complete form with complexity presets and result display"
      min_lines: 100
    - path: "frontend/src/lib/i18n/fr.ts"
      provides: "French labels for full quote feature"
      contains: "fullQuote"
  key_links:
    - from: "frontend/src/components/estimateur/full-quote-form.tsx"
      to: "frontend/src/lib/api/hybrid-quote.ts"
      via: "submitHybridQuote call"
      pattern: "submitHybridQuote"
    - from: "frontend/src/components/estimateur/full-quote-form.tsx"
      to: "frontend/src/components/estimateur/complexity-presets.tsx"
      via: "ComplexityPresets component"
      pattern: "ComplexityPresets"
    - from: "frontend/src/components/estimateur/full-quote-form.tsx"
      to: "frontend/src/components/estimateur/quote-result.tsx"
      via: "QuoteResult component render"
      pattern: "QuoteResult"
---

<objective>
Build invoice-style quote result display and wire form to hybrid quote API.

Purpose: Enable users to generate full quotes with work items, materials totals, and confidence indicators.
Output: Working quote generation form with professional invoice-style results display.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-full-quote-frontend/14-CONTEXT.md

# Plan 01 artifacts (types, API, presets)
@frontend/src/types/hybrid-quote.ts
@frontend/src/lib/api/hybrid-quote.ts
@frontend/src/components/estimateur/complexity-presets.tsx

# Existing patterns
@frontend/src/components/estimate-form.tsx
@frontend/src/lib/i18n/fr.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Quote result invoice display component</name>
  <files>frontend/src/components/estimateur/quote-result.tsx</files>
  <action>
Create invoice-style quote result component following the design from 14-CONTEXT.md:

**Props interface:**
```typescript
interface QuoteResultProps {
  quote: HybridQuoteResponse;
  category: string;
  sqft: number;
}
```

**Layout structure (see design doc):**
1. **Confidence warning banner** (only if overall_confidence < 0.5):
   - Yellow/amber background
   - Warning icon
   - Text: "Confiance: {X}% - Verification recommandee"

2. **Header section:**
   - "SOUMISSION" centered title
   - Category and superficie (sqft) with "pi2" unit

3. **Work items section:**
   - "TRAVAUX" section header
   - List each work_item with:
     - Bullet point + name (left aligned)
     - Labor hours (right aligned): "{X} hrs"
   - Use a clean table-like layout with consistent spacing

4. **Summary section:**
   - "SOMMAIRE" section header
   - "Materiaux" line with total_materials_cost formatted as CAD
   - "Main-d'oeuvre ({total_labor_hours} hrs)" with labor cost from Standard tier
   - Horizontal rule
   - "TOTAL" with total_price from Standard pricing tier (bold/emphasized)

5. **Reasoning section:**
   - Collapsible accordion with icon
   - "Raisonnement" header with expand/collapse chevron
   - Markdown rendering for reasoning content (use react-markdown)
   - Default collapsed

6. **Actions slot for Plan 14-03:**
   - Add a comment placeholder at the bottom of the component (inside the Card, after reasoning):
   ```tsx
   {/* QuoteActions slot - will be added by Plan 14-03 */}
   {/* <QuoteActions quote={quote} category={category} sqft={sqft} /> */}
   ```
   This allows Plan 14-03 to cleanly uncomment and wire the QuoteActions component.

**Formatting:**
- Use fr-CA locale for numbers (space as thousands separator)
- Currency: Intl.NumberFormat with CAD, no decimals for whole numbers
- Hours: one decimal place (e.g., "8.5 hrs")

**Styling:**
- Use Card component as container
- Section headers: uppercase, subtle border-bottom
- Total row: bolder weight, larger font
- Monospace alignment for numbers (tabular-nums)
  </action>
  <verify>
TypeScript compiles without errors:
```bash
cd frontend && npx tsc --noEmit
```
  </verify>
  <done>
QuoteResult component exists and displays:
- Confidence warning when < 50%
- Work items with hours
- Materials and labor totals
- Grand total from Standard tier
- Collapsible reasoning
- Commented placeholder for QuoteActions
  </done>
</task>

<task type="auto">
  <name>Task 2: i18n labels and full-quote-form integration</name>
  <files>
    frontend/src/lib/i18n/fr.ts
    frontend/src/components/estimateur/full-quote-form.tsx
  </files>
  <action>
**Part A: Add French labels to fr.ts**

Add a new `fullQuote` section to the fr object:

```typescript
fullQuote: {
  titre: "Soumission complete",
  description: "Generez une soumission complete avec travaux et materiaux",
  generer: "Generer la soumission",
  enChargement: "Generation en cours...",
  soumission: "SOUMISSION",
  categorie: "Categorie",
  superficie: "Superficie",
  travaux: "TRAVAUX",
  sommaire: "SOMMAIRE",
  materiaux: "Materiaux",
  mainOeuvre: "Main-d'oeuvre",
  total: "TOTAL",
  heures: "hrs",
  raisonnement: "Raisonnement",
  confiance: "Confiance",
  verificationRecommandee: "Verification recommandee",
  erreur: "Erreur lors de la generation",
  // Complexity labels
  complexite: "Complexite du travail",
  simple: "Simple",
  modere: "Modere",
  complexe: "Complexe",
  personnaliser: "Personnaliser les facteurs",
  accessDifficulte: "Difficulte d'acces",
  penteToit: "Pente du toit",
  penetrations: "Penetrations",
  retraitMateriaux: "Retrait de materiaux",
  securite: "Preoccupations de securite",
  delai: "Contraintes de delai",
  totalFacteurs: "Total",
},
```

**Part B: Rewrite full-quote-form.tsx**

Replace the placeholder component with a working form:

1. **Imports:**
   - useForm from react-hook-form
   - zodResolver from @hookform/resolvers
   - Form components from @/components/ui/form
   - Input, Select, Switch, Button, Slider from @/components/ui
   - ComplexityPresets from ./complexity-presets
   - QuoteResult from ./quote-result
   - hybridQuoteFormSchema, HybridQuoteFormData from @/lib/schemas/hybrid-quote
   - submitHybridQuote from @/lib/api/hybrid-quote
   - HybridQuoteResponse from @/types/hybrid-quote
   - CATEGORIES from @/lib/schemas
   - fr from @/lib/i18n/fr

2. **State:**
   - result: HybridQuoteResponse | null
   - isLoading: boolean
   - error: string | null

3. **Form setup:**
   - Default values matching Modere preset:
     - sqft: 1500
     - category: "Bardeaux"
     - complexity preset: "Modere"
     - All 6 factors at Modere values (5, 4, 5, 4, 5, 5)
     - material_lines: 5
     - labor_lines: 2
     - has_subs: false
     - has_chimney: false
     - has_skylights: false

4. **Form fields (in order):**
   - Superficie (sqft) - number input with "pi2" unit
   - Categorie - Select with CATEGORIES
   - ComplexityPresets component (integrated with form state via Controller)
   - Material lines - number input
   - Labor lines - number input
   - Has chimney - Switch
   - Has skylights - Switch
   - Has subcontractors - Switch

5. **onSubmit handler:**
   - Set isLoading true, clear error and result
   - Compute complexity_aggregate from 6 factors
   - Build HybridQuoteRequest payload
   - Call submitHybridQuote
   - Set result on success
   - Catch and display errors
   - Always set isLoading false

6. **Render (explicit QuoteResult placement):**
   - Card wrapper with title and description
   - Form with all fields
   - Submit button (disabled when loading)
   - Error display if error state is set
   - **Import QuoteResult and render below error display:**
     ```tsx
     import { QuoteResult } from "./quote-result";
     // ... in JSX:
     {result && <QuoteResult quote={result} category={formData.category} sqft={formData.sqft} />}
     ```
   - Use `watch("category")` and `watch("sqft")` or store in state to get current form values for QuoteResult props

7. **Complexity integration:**
   - Use Controller from react-hook-form for ComplexityPresets to integrate with form state
   - When preset changes, update all 6 factor fields via setValue
   - Watch 6 factor fields to compute aggregate for display

Use existing Card styling patterns from the codebase.
  </action>
  <verify>
1. TypeScript compiles:
```bash
cd frontend && npx tsc --noEmit
```
2. Start dev server and navigate to /estimateur/complet:
```bash
cd frontend && npm run dev
```
Form should render with all fields and complexity presets.

**Note:** Backend from Phase 13 must be running for full end-to-end test. TypeScript compilation verifies type safety without backend.
  </verify>
  <done>
- fr.ts contains fullQuote section with all labels
- full-quote-form.tsx is a working form with complexity presets
- QuoteResult is imported and rendered: {result && <QuoteResult quote={result} category={...} sqft={...} />}
- ComplexityPresets integrates with form via Controller
- Form submits to /estimate/hybrid and displays QuoteResult
- All text is in French
  </done>
</task>

</tasks>

<verification>
1. Navigate to http://localhost:3000/estimateur/complet
2. Form displays with complexity preset selector
3. Selecting "Complexe" updates slider values
4. Submit shows invoice-style result (requires backend running)
5. Confidence < 50% shows warning banner
6. Reasoning section expands/collapses
</verification>

<success_criteria>
- Quote result displays work items with hours
- Materials and labor totals formatted as CAD currency
- Confidence warning appears when < 50%
- Reasoning is collapsible
- All French labels render correctly
- Form submits and displays results
- ComplexityPresets component controlled via react-hook-form Controller
</success_criteria>

<output>
After completion, create `.planning/phases/14-full-quote-frontend/14-02-SUMMARY.md`
</output>
